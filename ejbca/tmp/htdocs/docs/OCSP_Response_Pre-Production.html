<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>OCSP Response Pre-Production - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=100272531"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations_Guide.html">EJBCA Operations Guide</a></li>
                                                                                                         <li class="shortcut"><a href="CA_Operations_Guide.html">CA Operations Guide</a></li>
                                                                                     <li><a href="OCSP_Management.html">OCSP Management</a></li>
                                                            </ul>
</div>            <h1 id="src-100272531"> <span>OCSP Response Pre-Production</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>    <span style="color: #000000;">
    </span>
</p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p   
>    <span style="color: #000000;">
Pre-produced OCSP responses (as described in <a  class="external-link" href="https://tools.ietf.org/html/rfc6960#section-2.5">RFC 6960 section 2.5</a>) allow responses to be pre-produced and persisted before they are requested. This allows for increased throughput on the OCSP responders since signing responses commonly becomes a bottleneck during peak loads.    </span>
</p>
<p   
>    <span style="color: #000000;">
The following covers all aspects of setting up and managing pre-production of OCSP responses. For more conceptual information, see Pre-Produced OCSP Responses in <a   href="OCSP.html">OCSP</a>.<br/>    </span>
</p>
<p   
></p>
<ul class="toc-indentation "></ul>    <div class="section section-1" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-EnablingOCSPPre-Production">
        <h1 class="heading "><span>Enabling OCSP Pre-Production</span></h1>
<p   
>    <span style="color: #000000;">
OCSP pre-production is enabled per CA level. Unless enabled, EJBCA will never serve or persist pre-produced responses for this CA.    </span>
</p>
<p   
>    <span style="color: #000000;">
To enable OCSP pre-production:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Go to <strong class=" ">CA UI &rarr; Certification Authorities</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select CA and click <strong class=" ">Edit.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Pre-produce OCSP Responses</strong> and click <strong class=" ">Save</strong>.    </span>
</p>
</li></ol>    <div class="section section-2" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-Storeresponseson-demand">
        <h2 class="heading "><span>Store responses on-demand</span></h2>
<p   
>    <span style="color: #000000;">
Enabling <strong class=" ">Store Responses on-demand</strong> will persist a copy of OCSP Responses generated while requesting the status of certificates issued by this CA. The persisted response will be used to serve future requests for the same certificate until the response validity expires or a newer response is generated. If the persisted response <strong class=" ">nextUpdate</strong> field has passed the current date while requesting the certificate status, the responder will generate and store a new response in parallel with answering the request.    </span>
</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>    <span style="color: #000000;">
The response to an OCSP Request containing status requests for multiple certificates will not be persisted for future use since the number of possible permutations makes it unlikely to ever be reused.    </span>
</p>
        </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-GeneratingResponses">
        <h1 class="heading "><span>Generating Responses</span></h1>
<p   
>    <span style="color: #000000;">
There are two ways of generating pre-produced OCSP Responses. Either by allowing <strong class=" ">on-demand</strong> response generation (see <a   href="#src-100272531_id-.OCSPResponsePreProductionv7.4.3-Storeresponseson-demand">Store responses on-demand</a>) or by setting up an <a   href="OCSP_Response_Pre-Signer.html">OCSP Response Pre-Signer</a><strong class=" "> </strong>service. Both approaches may be used at the same time.    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">On-demand</strong>: Responses are persisted, upon request and used for future requests until it expires.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">OCSP Response Presigner</strong>: Generates, persists and updates responses for all certificates issued by the configured CAs.    </span>
</p>
</li></ul><p   
><img  class="confluence-embedded-image"  src="images/download/attachments/100272531/serviceworker.png" alt="images/download/attachments/100272531/serviceworker.png" width="690"  />
    </p>
<p   
>For more information on the service worker, see <a   href="OCSP_Response_Pre-Signer.html">OCSP Response Pre-Signer</a>.</p>
    </div>
    <div class="section section-1" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-CleaningupResponses">
        <h1 class="heading "><span>Cleaning up Responses</span></h1>
<p   
>    <span style="color: #000000;">
This functionality enables the periodical removal of old/expired responses stored by the <strong class=" ">OCSP Response Pre-signer</strong>. It removes all responses except the ones with the latest &quot;<tt class=" ">producedAt</tt>&quot; for each response to the corresponding certificate.    </span>
</p>
<p   
>    <span style="color: #000000;">
When enabled, it runs on an interval schedule defined by every <strong class=" ">X</strong> days/hours/minutes.    </span>
</p>
<p   
>    <span style="color: #000000;">
To enable response cleanup:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">System Configuration &rarr; Basic Configuration</strong>.<br/>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Activate</strong> for <strong class=" ">Enable OCSP Responses Cleanup</strong> in the <strong class=" ">OCSP Options</strong> section.<strong class=" "><br/></strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
    <span style="color: #000000;">
Select an interval.     </span>
Valid schedule interval values are:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
<i class=" ">Days</i>: [1-31]    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Hours: [1-23]    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Minu<i class=" ">tes:</i> [1-59]    </span>
</p>
</li></ul></li></ol><p   
><img  class="confluence-embedded-image"  src="images/download/attachments/100272531/image2020-6-3_15-5-25.png" alt="images/download/attachments/100272531/image2020-6-3_15-5-25.png" width="700"  />
    </p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>    <span style="color: #000000;">
It is recommended to keep <strong class=" ">Enable OCSP Responses Cleanup</strong> enabled in environments where new responses are generated continuously with short expiration times (i.e. short <strong class=" ">nextUpdate</strong> times).    </span>
</p>
        </div>
    </div>
    </div>
    <div class="section section-1" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-PublishingofOCSPResponses">
        <h1 class="heading "><span>Publishing of OCSP Responses</span></h1>
<p   
>    <span style="color: #000000;">
Two types of publishers support publishing of OCSP responses, the <strong class=" ">Validation Authority Peer Publisher</strong> and the <strong class=" ">Validation Authority Publisher</strong>.    </span>
</p>
<p   
>    <span style="color: #000000;">
    <span style="color: #0e101a;">
Like the Validation Authority Publisher, the Validation Authority    </span>
    <span style="color: #0e101a;">
 Peer Publisher    </span>
    <span style="color: #0e101a;">
 publishes issued certificates from an EJBCA CA to a VA, but over TLS using EJBCA <a   href="Peer_Systems.html">Peer Systems</a>    </span>
    <span style="color: #0e101a;">
. For more information about the publishers, see <a   href="Validation_Authority_Peer_Publisher.html">Validation Authority Peer Publisher</a> and the <a   href="Validation_Authority_Publisher_%28Legacy%29.html">Validation Authority Publisher</a>.<br/>    </span>
    </span>
</p>
    <div class="section section-2" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-ValidationAuthorityPeerPublisher">
        <h2 class="heading "><span>Validation Authority Peer Publisher</span></h2>
<p   
>    <span style="color: #000000;">
To allow publishing OCSP responses on a VA, create a Validation Authority Peer Publisher configured according to the following example.    </span>
</p>
<p   
>    <span style="color: #000000;">
Note that the option <strong class=" ">Store OCSP Responses at the Validation Authority</strong> must be enabled in order for the responses to get published.    </span>
</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/100272531/peerPublisher.jpg" alt="images/download/attachments/100272531/peerPublisher.jpg" width="600"  />
    </p>
<p   
>    <span style="color: #000000;">
The <strong class=" ">Publisher Queue</strong> configuration works similarly to CRLs and certificates. If the option <strong class=" ">Use queue for OCSP responses </strong>is enabled, then if something goes wrong while publishing the responses to the VA, the responses will get queued waiting for the next round of queue processing.    </span>
</p>
    </div>
    <div class="section section-2" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-ValidationAuthorityPublisher">
        <h2 class="heading "><span>Validation Authority Publisher</span></h2>
<p   
>    <span style="color: #000000;">
To use the Validation Authority Publisher, create a Validation Authority Publisher configured according to the following example.    </span>
</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/100272531/VAP.jpg" alt="images/download/attachments/100272531/VAP.jpg" width="600"  />
    </p>
<p   
>    <span style="color: #000000;">
Enabling <strong class=" ">Store OCSP Responses at the Validation Authority</strong> results in publishing the OCSP responses using the Data Source set in the Validation Authority Publisher configuration. For more information on VA Publisher settings, see <a   href="Validation_Authority_Publisher_%28Legacy%29.html">Validation Authority Publisher</a>.<br/>    </span>
</p>
<p   
>    <span style="color: #000000;">
Note that according to the implementation, publishing of OCSP responses occurs asynchronously and right after creating the OCSP response, signing it and returning the response to the client.    </span>
</p>
    </div>
    </div>
    <div class="section section-1" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-OCSPExtensionsSupportedExtensions">
        <h1 class="heading "><span>OCSP Extensions </span></h1>
<p   
>    <span style="color: #000000;">
Generally, EJBCA will not persist responses containing extensions with the exceptions of the extensions below. However, such requests will still be served as usual when no stored response exists. That is, a new response will be generated for those requests.    </span>
</p>
    <div class="section section-2" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-Nonce">
        <h2 class="heading "><span>Nonce</span></h2>
<p   
>    <span style="color: #000000;">
Having &quot;pre-produced&quot; responses enabled will still allow the client to send a request with the nonce extension. However, the responder will ignore that and send a response back without the nonce extension. This is because each nonce is only valid for that specific request and it cannot be served to other clients. Hence it does not make sense to persist the response for future use.    </span>
</p>
    </div>
    <div class="section section-2" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-ArchiveCutoff">
        <h2 class="heading "><span>Archive Cutoff</span></h2>
<p   
>    <span style="color: #000000;">
If Archive Cutoff is configured for the responder, it will also be used while pre-producing responses for it. That is, the behavior is unchanged compared to not using pre-produced responses. For more information, see <a   href="Archive_Cutoff.html">Archive Cutoff</a>.<br/>    </span>
</p>
    </div>
    </div>
    <div class="section section-1" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-IssuingFinalOCSPResponses">
        <h1 class="heading "><span>Issuing Final OCSP Responses</span></h1>
<p   
>According to <a  class="external-link" href="https://www.etsi.org/deliver/etsi_en/319400_319499/31941102/02.02.00_20/en_31941102v020200a.pdf">ETSI EN 319 411-2</a> (CSS-6.3.10-09), Trust Service Providers (TSPs) may compute a last OCSP answer for each and every issued certificate when the CAs certificate is about to expire. This is in practice done by generating responses with 'nextUpdate' set to '99991231235959Z', sign and persist them before the CA expires. The <a   href="OCSP_Response_Pre-Signer.html">OCSP Response Pre-Signer</a> service can be used to perform such an operation.</p>
<p   
>Since signing responses for every certificate issued by a CA may be very time consuming and cause high HSM load, this should be done well in advance of the CA expiration date. The time interval can be configured using the <strong class=" ">Time Before CA Expires</strong> input field. Once a final OCSP response has been issued for a certificate, no new responses will be persisted for that certificate. For more information on the service settings, see <a   href="OCSP_Response_Pre-Signer.html">OCSP Response Pre-Signer</a>.</p>
    </div>
    <div class="section section-1" id="src-100272531_id-.OCSPResponsePreProductionv7.4.3-CreatePre-ProducedOCSPResponsesSignedbyaCA">
        <h1 class="heading "><span>Create Pre-Produced OCSP Responses Signed by a CA</span></h1>
<p   
>If you want to issue pre-produced OCSP responses directly from a CA, using the CA's signing key, you can do so by not creating an OCSP key binding for the CA. You also need to specify the validity time of OCSP responses in <tt class=" ">conf/ocsp.properties</tt>.</p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="OCSP_Management.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>OCSP Management</span>
        </a>
                <a href="Setting_up_a_Responder_Using_the_CLI.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Setting up a Responder Using the CLI</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
