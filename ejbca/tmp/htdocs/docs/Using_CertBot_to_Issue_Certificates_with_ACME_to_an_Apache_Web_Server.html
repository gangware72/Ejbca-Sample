<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using CertBot to Issue Certificates with ACME to an Apache Web Server - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=93587213"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Integration.html">EJBCA Integration</a></li>
                                                                                     <li><a href="Integrating_with_Third-Party_Applications.html">Integrating with Third-Party Applications</a></li>
                                                            </ul>
</div>            <h1 id="src-93587213"> <span>Using CertBot to Issue Certificates with ACME to an Apache Web Server</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

    <div class="section section-1" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Introduction">
        <h1 class="heading "><span>Introduction</span></h1>
<p   
>This integration document shows how to use the popular ACME agent <a  class="external-link" href="https://certbot.eff.org/"><i class=" ">CertBot</i></a> to automatically create and renew TLS certificates for an <a  class="external-link" href="https://httpd.apache.org/">Apache web server</a>. The same setup can easily be used for other web servers that CertBot has support for, for example <a  class="external-link" href="https://www.nginx.com/">NGINX</a>. With a TLS certificate, the web server can be reached using the HTTPS protocol, and all traffic to and from the web server is encrypted.</p>
<p   
>The following describes how to issue <i class=" "><strong class=" ">private</strong></i> TLS certificates for usage in your organization.</p>
    </div>
    <div class="section section-1" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Prerequisites">
        <h1 class="heading "><span>Prerequisites</span></h1>
<p   
>    <span style="color: #000000;">
Issuing web host certificates using ACME makes use of DNS for authorizing issuance of certificates for a specific domain. Therefore it is important that both the web host and the CA have proper FQDNs and that these are in the DNS. The CA needs to be able to reach the web server, looking up its FQDN in DNS.    </span>
</p>
<p   
>    <span style="color: #000000;">
The following prerequisites are required to complete the issuance:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
EJBCA    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
EJBCA Enterprise (with ACME support) deployed on an Ubuntu server, configured with:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
A CA that will issue web server certificates    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
A certificate profile in EJBCA for the web server certificates    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
An end entity profile in EJBCA for the web server certificates that is configured to use the web server certificate profile    </span>
</p>
</li></ul></li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
Apache web server    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
A server/VM installed with Ubuntu 19.04 (as used in this guide, other operating systems should work the same/similarly)    </span>
</p>
</li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
DNS host records    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
A host record for the CA server, used by the web server to contact the CA (in this guide <tt class=" ">ejbca.example.com)</tt>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
A host record for the web server, used by the CA to contact the web server for ACME http-01 authorization (in this guide <tt class=" ">tgacme.com</tt> and <tt class=" ">www.tgacme.com)</tt>    </span>
</p>
</li></ul></li></ul>    </div>
    <div class="section section-1" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-IssueWebServerTLSCertificateoverACMEwithCertBot">
        <h1 class="heading "><span>Issue Web Server TLS Certificate over ACME with CertBot</span></h1>
<p   
>    <span style="color: #000000;">
To complete issuance of a web server certificate, follow the steps outlined in the sections below.    </span>
</p>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step1-TrustedCACertificateConfiguration">Step 1 - Trusted CA Certificate Configuration</a></p>
</li><li class=" "><p   
><a   href="#src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step2-ConfigureEJBCAontheCAHost">Step 2 - Configure EJBCA on the CA Host</a></p>
</li><li class=" "><p   
><a   href="#src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step3-InstallCertBotontheApacheWebServerHost">Step 3 - Install CertBot on the Apache Web Server Host</a></p>
</li><li class=" "><p   
><a   href="#src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step4-IssueWebServerCertificate">Step 4 - Issue Web Server Certificate</a></p>
</li><li class=" "><p   
><a   href="#src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step5-ConfigureCertBotforAutomaticMonitoringofExpiry">Step 5 - Configure CertBot for Automatic Monitoring of Expiry</a></p>
</li></ul>    <div class="section section-2" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step1-TrustedCACertificateConfiguration">
        <h2 class="heading "><span>Step 1 - Trusted CA Certificate Configuration</span></h2>
<p   
>    <span style="color: #000000;">
In order to contact the CA server over <i class=" ">https</i>, the CA certificate that signs your servers (EJBCA and Apache) TLS certificates needs to be installed as trusted in your systems, both the EJBCA host and the Web host. If not, CertBot will not be able to talk to the CA.    </span>
</p>
<p   
>    <span style="color: #000000;">
In this guide, the Management CA (a Root CA) is used and the Management CA certificate has been downloaded as <strong class=" ">/tmp/ManagementCA.cacert.pem</strong>.    </span>
</p>
<p   
>    <span style="color: #000000;">
Run the following on both servers:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo mkdir /usr/share/ca-certificates/extra/</code></div>
<div class="line"><code class="plain">sudo cp /tmp/ManagementCA.cacert.pem /usr/share/ca-certificates/extra/ManagementCA.cacert.crt</code></div>
<div class="line"><code class="plain">echo </code><code class="string">'extra/ManagementCA.cacert.crt'</code><code class="plain"> | sudo tee -a /etc/ca-certificates.conf</code></div>
<div class="line"><code class="plain">sudo update-ca-certificates</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
Next, test that you can access the CA server from both the CA itself and the web server. Example URL:    </span>
 <a  class="external-link" href="https://ejbca.example.com:8442/">https://ejbca.example.com:8442/</a></p>
    </div>
    <div class="section section-2" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step2-ConfigureEJBCAontheCAHost">
        <h2 class="heading "><span>Step 2 - Configure EJBCA on the CA Host </span></h2>
<p   
>    <span style="color: #000000;">
Perform the following steps to configure EJBCA on the CA host:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
To configure the Management CA to allow the same subject DN on multiple end entities:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
In the EJBCA Admin UI, click <strong class=" ">Certificate Authorities&gt;Management CA&gt;Edit</strong> and set the following:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
Enforce unique public keys = unchecked.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Enforce unique DN = unchecked.<br/>    </span>
</p>
</li></ul></li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
To create a Server Certificate Profile, SslServerProfile :    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
To clone the SERVER certificate profile, click <strong class=" ">Certificate Profiles&gt;SERVER&gt;Clone</strong> and set the following:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
Extended Key Usage = Server Authentication.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Available CA: Any CA.    </span>
</p>
</li></ul></li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
To create a Server End Entity Profile, SslServerProfile:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
In the EJBCA Admin UI, click <strong class=" ">End Entity Profiles&gt;Add profile</strong> and set the following:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
End Entity E-mail: Use, Modifiable.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Subject DN Attributes: Only CN, Required and Modifiable.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Subject Alternative Name: two DNSName.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Default/Available Certificate Profile: SslServerProfile.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Default/Available CA: Management CA.    </span>
</p>
</li></ul></li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
Enable the ACME protocol under <strong class=" ">System Configuration&gt;Protocol Configuration</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Add an ACME alias in EJBCA:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
In the EJBCA Admin UI, click <strong class=" ">ACME Configuration&gt;Add</strong> and set the following:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
End Entity Profile: SslServerProfile.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Site URL:    </span>
 <a  class="external-link" href="https://www.primekey.com/">https://www.primekey.com/</a></p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Terms of Service URL:    </span>
 <a  class="external-link" href="https://primekey.com/products/software/">https://primekey.com/products/software/</a></p>
</li><li class=" "><p   
>    <span style="color: #000000;">
DNS Resolver: 8.8.8.8.<br/>    </span>
</p>
</li></ul></li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
Set the ACME alias as <strong class=" ">Default ACME configuration</strong> in the ACME Configuration Overview (<strong class=" ">EJBCA Admin UI&gt;ACME Configuration</strong>).<br/>    </span>
</p>
</li></ol><p   
>    <span style="color: #000000;">
The following displays an example ACME alias configuration:    </span>
</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93587213/acmeserver-alias.png" alt="images/download/attachments/93587213/acmeserver-alias.png" width="500"  />
        <br/><span class="caption">Screenshot of example ACME configuration</span>
    </p>
    </div>
    <div class="section section-2" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step3-InstallCertBotontheApacheWebServerHost">
        <h2 class="heading "><span>Step 3 - Install CertBot on the Apache Web Server Host</span></h2>
<p   
>    <span style="color: #000000;">
On the Web host, install CertBot using the following command. Note that you may need to run <tt class=" ">sudo apt update</tt> on a fresh installation.    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo apt install python3-certbot-apache</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
The above command installs the Apache2 web server automatically.    </span>
</p>
    </div>
    <div class="section section-2" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step4-IssueWebServerCertificate">
        <h2 class="heading "><span>Step 4 - Issue Web Server Certificate </span></h2>
<p   
>    <span style="color: #000000;">
First, to test that <i class=" ">https</i> is not available, test the following in a web browser:    </span>
</p>
<ul class=" "><li class=" "><p   
><a  class="external-link" href="http://tgacme.com">http://tgacme.com</a> -    <span style="color: #000000;">
 Should show the Apache default web page    </span>
</p>
</li><li class=" "><p   
><a  class="external-link" href="https://tgacme.com">https://tgacme.com</a>     <span style="color: #000000;">
- Should show an error that the browser cannot connect    </span>
</p>
</li></ul><p   
>    <span style="color: #000000;">
Next, run certbot to install the certificate from the EJBCA server:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">sudo certbot --server https:</code><code class="comments">//ejbca.example.com:8442/ejbca/acme/directory -d tgacme.com --apache --agree-tos --email admin@example.com --no-eff-email --noninteractive</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
Then test with the web browser again:    </span>
</p>
<ul class=" "><li class=" "><p   
><a  class="external-link" href="https://tgacme.com">https://tgacme.com</a>     <span style="color: #000000;">
- Should now connect and show the Apache default web page.    </span>
</p>
</li></ul><p   
>    <span style="color: #000000;">
Additionally, you can go to the certificate view page of your web browser and inspect the web server certificate (that the issuer is the private Management CA).    </span>
</p>
    </div>
    <div class="section section-2" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-Step5-ConfigureCertBotforAutomaticMonitoringofExpiry">
        <h2 class="heading "><span>Step 5 - Configure CertBot for Automatic Monitoring of Expiry </span></h2>
<p   
>    <span style="color: #000000;">
You can now configure CertBot     </span>
    <span style="color: #000000;">
for automatic monitoring of expiry.     </span>
    <span style="color: #000000;">
For information on configuring CertBot, refer to the <a  class="external-link" href="https://certbot.eff.org/">CertBot documentation</a>.    </span>
</p>
    </div>
    </div>
    <div class="section section-1" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-AdditionalNotes">
        <h1 class="heading "><span>Additional Notes</span></h1>
    <div class="section section-2" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-RolesandResponsibilities">
        <h2 class="heading "><span>Roles and Responsibilities </span></h2>
<p   
>    <span style="color: #000000;">
There are at least three distinct roles used in this guide and more roles may be relevant.<br/>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">CA administrator</strong><i class=" ">: </i>performing the configuration of EJBCA. This role can further be divided for CA role separation, for example:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
CA policy administrator, configuring certificate- and end entity profiles ensuring that properly formatted certificates are issued.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
CA protocol administrator, configuring ACME aliases.    </span>
</p>
</li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">Web server administrator</strong>, performing configuration of the Apache server and CertBot on the web host.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
<strong class=" ">DNS administrator</strong>, adding records to the DNS enabling ACME authorization.    </span>
</p>
</li></ol><p   
>    <span style="color: #000000;">
In addition, it is recommended to monitor all web hosts for expiring certificates. There is a plethora of tools for this, and it is probably included as part of your organization server monitoring solution.    </span>
</p>
    </div>
    <div class="section section-2" id="src-93587213_safe-id-aWQtLlVzaW5nQ2VydEJvdHRvSXNzdWVDZXJ0aWZpY2F0ZXN3aXRoQUNNRXRvYW5BcGFjaGVXZWJTZXJ2ZXJ2Ny40LjAtQ2xlYW51cC9SZXNldFdlYlNlcnZlcnRvUnVuQWdhaW4">
        <h2 class="heading "><span>Cleanup/Reset Web Server to Run Again</span></h2>
<p   
>    <span style="color: #000000;">
A simple script can be run on the web host to re-install Apache and CertBot, making it straightforward to run the test as many times as you want, the same fresh installation every time.    </span>
</p>
<p   
>    <span style="color: #000000;">
The steps are outlined below to describe the process although the script can be run during the initial setup as well.    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/home/user/certbot-reinstall.sh</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
The script does the following:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">#!/bin/bash</code></div>
<div class="line"><code class="plain">sudo apt-get -yq remove --purge python3-certbot-apache</code></div>
<div class="line"><code class="plain">sudo apt-get -yq remove --purge apache2</code></div>
<div class="line"><code class="plain">sudo rm -rf /etc/letsencrypt</code></div>
<div class="line"><code class="plain">sudo rm -rf /etc/apache2</code></div>
<div class="line"><code class="plain">sudo apt-get -yq --ignore-missing install python3-certbot-apache</code></div>
</div>
    </div>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
Test with browser:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
http://tgacme.com - Shows the Apache default web page    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
https://tgacme.com - Shows an error that the browser cannot connect.    </span>
</p>
</li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
sudo certbot --server <tt class=" ">https://ejbca.example.com:8442/ejbca/acme/directory</tt> -d tgacme.com --apache --agree-tos --email admin@example.com --no-eff-email --noninteractive    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Test with browser:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
https://tgacme.com - Connects and shows the Apache default web page.    </span>
</p>
</li></ul></li><li class=" "><p   
>    <span style="color: #000000;">
Show the web server certificate in the browser (and verify that it comes from the private Management CA)    </span>
</p>
</li></ul>    </div>
    <div class="section section-2" id="src-93587213_id-.UsingCertBottoIssueCertificateswithACMEtoanApacheWebServerv7.4.0-CertBotonaFreshUbuntu18.04orLowerHost">
        <h2 class="heading "><span>CertBot on a Fresh Ubuntu 18.04 or Lower Host</span></h2>
<p   
>    <span style="color: #000000;">
Without updating the Ubuntu repos, the client that will be installed is 0.23. This is older and not supported by EJBCA version &gt; 7.3.0.    </span>
</p>
<p   
>    <span style="color: #000000;">
To install a newer CertBot version, use the following commands:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="functions">sudo</code><code class="plain"> apt-get -y update</code></div>
<div class="line"><code class="functions">sudo</code><code class="plain"> apt-get -y </code><code class="functions">install</code><code class="plain"> software-properties-common</code></div>
<div class="line"><code class="functions">sudo</code><code class="plain"> add-apt-repository -y universe</code></div>
<div class="line"><code class="functions">sudo</code><code class="plain"> add-apt-repository -y ppa:certbot</code><code class="plain">/certbot</code></div>
<div class="line"><code class="functions">sudo</code><code class="plain"> apt-get -y update</code></div>
<div class="line"> </div>
<div class="line"><code class="functions">sudo</code><code class="plain"> apt-get -y </code><code class="functions">install</code><code class="plain"> certbot python3-certbot-apache </code></div>
</div>
    </div>
    </div>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Setting_up_an_Apache_Web_Server_with_mod_jk.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Setting up an Apache Web Server with mod_jk</span>
        </a>
                <a href="Setting_up_a_HA_Proxy_in_front_of_EJBCA.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Setting up a HA Proxy in front of EJBCA</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
