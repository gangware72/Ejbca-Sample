<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>EJBCA REST Interface - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=100270321"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_CA_Concept_Guide.html">EJBCA CA Concept Guide</a></li>
                                                                                     <li><a href="Protocols.html">Protocols</a></li>
                                                            </ul>
</div>            <h1 id="src-100270321"> <span>EJBCA REST Interface</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p   
>The following covers information on the EJBCA REST Interface for Certificate Management and CA Administration operations.</p>
<p   
></p>
<ul class="toc-indentation "></ul>    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-APIOverview">
        <h1 class="heading "><span>API Overview</span></h1>
<p   
>EJBCA Certificate Management REST API contains endpoints intended for integration with EJBCA, using CA Management, Crypto token management, and Certificate management RESTful Web Services. This allows for easy integration and lightweight HTTP interaction for the most crucial parts of EJBCA.</p>
<p   
>The scope of the API is limited compared to the full set of features provided by EJBCA and provides functionality such as certificate requests, enrollment, revocation and more. For a full description of the functionality provided, see <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-resources">Resources</a>.</p>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-RESTAPIReferencerest_api_reference">
        <h1 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-rest_api_reference" class="confluence-anchor-link"></span><span>REST API Reference </span></h1>
<p   style="text-align:left;"
>Each EJBCA release is bundled with an auto-generated REST API reference available on the URL <strong class=" ">https://localhost:8442/ejbca/doc/rest/ </strong>if deployed.<strong class=" "><br/></strong></p>
<p   style="text-align:left;"
><img  class="confluence-embedded-image"  src="images/download/attachments/100270321/image2019-5-27_14-49-24.png" alt="images/download/attachments/100270321/image2019-5-27_14-49-24.png"  height="250" />
    </p>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-SwaggerUIswagger">
        <h1 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-swagger" class="confluence-anchor-link"></span><span>Swagger UI </span></h1>
<p   style="text-align:left;"
>    <span style="color: #000000;">
Swagger UI allows you to visualize and interact with the API&rsquo;s resources. The Swagger UI playground is available in your browser on the URL <strong class=" ">https://localhost:8443/</strong>    </span>
<strong class=" ">    <span style="color: #000000;">
ejbca/swagger-ui    </span>
</strong>    <span style="color: #000000;">
 (use port 8443 since the REST API uses client certificate authentication).<br/>    </span>
</p>
<p   style="text-align:left;"
><img  class="confluence-embedded-image"  src="images/download/attachments/100270321/image2019-5-27_14-50-18.png" alt="images/download/attachments/100270321/image2019-5-27_14-50-18.png"  height="250" />
    </p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   style="text-align:left;"
>    <span style="color: #000000;">
The Swagger UI is only available if you build EJBCA in non-production mode, i.e. with <i class=" ">ejbca.productionmode=false</i> set in <i class=" ">conf/ejbca.properties</i>, and if REST is activated as a protocol (see below).<br/>    </span>
</p>
        </div>
    </div>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-GettingStartedgetting_started">
        <h1 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-getting_started" class="confluence-anchor-link"></span><span>Getting Started </span></h1>
<p   style="text-align:left;"
>    <span style="color: #808080;">
    <span style="color: #000000;">
    <span style="color: #000000;">
The EJBCA Certificate Management REST API is disabled by default. To enable the service, go to <strong class=" ">Administrator Web &gt; System Configuration &gt; Protocol Configuration</strong> and select <strong class=" ">Enable</strong> for the REST end point you want to use.    </span>
    </span>
    </span>
</p>
<p   style="text-align:left;"
>    <span style="color: #808080;">
    <span style="color: #000000;">
    <span style="color: #000000;">
<img  class="confluence-embedded-image"  src="images/download/attachments/100270321/protocols.png" alt="images/download/attachments/100270321/protocols.png"  height="400" />
    </span>
    </span>
    </span>
</p>
<p   style="text-align:left;"
>    <span style="color: #808080;">
    <span style="color: #000000;">
Integrating with the REST API and consuming the response can be done with any tool of choice. For basic GET requests, any web browser is sufficient and for improved integration, a REST library or similar tool is recommended.    </span>
    </span>
</p>
<p   
>The following shows an example of a basic request:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">GET https:</code><code class="comments">//localhost:8443/ejbca/ejbca-rest-api/v1/certificate/status</code></div>
</div>
    </div>
<p   
>Resulting in the following JSON response. Note that version and revision may vary.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="string">"status"</code><code class="plain">:</code><code class="string">"OK"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"version"</code><code class="plain">:</code><code class="string">"1.0"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"revision"</code><code class="plain">:</code><code class="string">"ALPHA"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>You can access the URL above using for example cURL, your browser, or any other tool. Note that the REST API requires client certificate authentication, see <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-authentication">Authentication</a>.</p>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-IntegratingwiththeRESTAPI">
        <h1 class="heading "><span>Integrating with the REST API</span></h1>
<p   
>Requests to the API are submitted using RESTful URLs with the standard HTTP methods: <tt class=" ">GET,</tt> <tt class=" ">POST, PUT.</tt> Additionally, some endpoints accept a JSON request body. Put together, each request consists of the HTTP method, endpoint URL, and (for some endpoints) a request body. Some endpoints require you to include an HTTP method header:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">Content-Type: application/json</code></div>
</div>
    </div>
<p   
>Generally, responses consist of an HTTP header including an RFC 2616 status code, and an application/json response body. For information on exceptions, see <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-responses">Responses</a>.</p>
<p   
>In case of an error, the response body contains an appropriate error message describing the event.</p>
    <div class="section section-2" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-Resourcesresources">
        <h2 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-resources" class="confluence-anchor-link"></span><span> Resources </span></h2>
<p   
>The certificate management REST API provides four base resource URLs:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/ejbca/ejbca-rest-api/v1/ca_management/</code></div>
<div class="line"><code class="plain">/ejbca/ejbca-rest-api/v1/ca/</code></div>
<div class="line"><code class="plain">/ejbca/ejbca-rest-api/v1/certificate/</code></div>
<div class="line"><code class="plain">/ejbca/ejbca-rest-api/v1/cryptotoken/</code></div>
<div class="line"><code class="plain">/ejbca/ejbca-rest-api/v1/endentity/</code></div>
</div>
    </div>
<p   
>Each resource provides endpoints of interaction.</p>
<p   
>Endpoints under the <strong class=" ">/ca_management/</strong> resource allow manipulating CAs, for example activating and deactivating a CA.</p>
<p   
>The <strong class=" ">/ca/</strong> resource allows retrieving CA certificates, CRLs, and so on.</p>
<p   
>The <strong class=" ">/certificate/</strong> resource handles certificate enrollment, revocation and other workflows related to managing certificates.</p>
<p   
>The <strong class=" ">/cryptotoken/</strong> resource handles crypto token activation, deactivation, and crypto token key generation.</p>
<p   
>The <strong class=" ">/endentity/</strong> resource handles adding, editing and deleting end entities.</p>
<p   
>For a full set of all endpoints, required input, responses, and other endpoint descriptions, see <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-rest_api_reference">REST API Reference</a> or try it out in the <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-swagger">Swagger UI</a>.</p>
    <div class="section section-3" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-Requests">
        <h3 class="heading "><span>Requests</span></h3>
<p   
>Each endpoint URL is built in the same way by the following structure:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">https:</code><code class="comments">//[DOMAIN_NAME]:[PORT]/ejbca/ejbca-rest-api/[API_VERSION]/[RESOURCE]/[IDENTIFIER]/[OPERATION]?[QUERY_PARAM]</code></div>
</div>
    </div>
<p   
><strong class=" ">Explanation</strong></p>
<ul class=" "><li class=" "><p   
>DOMAIN_NAME: Domain name of the EJBCA instance, for example: <strong class=" ">localhost.</strong></p>
</li><li class=" "><p   
>PORT: Secure port of the EJBCA instance, for example: <strong class=" ">8443</strong>.</p>
</li><li class=" "><p   
>API_VERSION: Version of the REST API, for example: <strong class=" ">v1</strong>.</p>
</li><li class=" "><p   
>RESOURCE: One of the two base resources <strong class=" ">/ca/</strong> or <strong class=" ">/certificate/</strong>.</p>
</li><li class=" "><p   
>IDENTIFIER: Identifier of the entity to perform the operation on. This might be a Subject DN, serial number or both combined. A composite identifier could look like <strong class=" ">.../{issuer_dn}/{certificate_serial_number_hex}/revocationstatus</strong>.</p>
</li><li class=" "><p   
>OPERATION: The operation to perform, for example: <strong class=" ">/revocationstatus</strong>.</p>
</li><li class=" "><p   
>QUERY_PARAM: HTTP query parameters. Some endpoints accept query parameters rather than a JSON body. For example <strong class=" ">.../revoke?reason=KEY_COMPROMISE</strong>.</p>
</li></ul><p   
>Note that not all endpoints require the identifier or query parameters. For example, the following is not specific for an entity and does not accept an identifier:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">GET https:</code><code class="comments">//localhost:8443/ejbca/ejbca-rest-api/v1/ca/status</code></div>
</div>
    </div>
<p   
><strong class=" ">Methods</strong></p>
<p   
>Each request requires a specified HTTP method. The expected method for each endpoint can be seen in <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-rest_api_reference">REST API Reference</a> or in the <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-swagger">Swagger UI</a>.</p>
<p   
>In general, the method used corresponds to the expected state change performed.</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Method</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Example</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>GET</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Used only to read data and not change it.</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>.../{issuer_dn}/{certificate_serial_number_hex}/revocationstatus</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>PUT</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Used in operations that updates some entity state.</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>.../{issuer_dn}/{certificate_serial_number_hex}/revoke</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>POST</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Used in operations which creates some entity.</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>.../enrollkeystore</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>DELETE</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Used in operations which deletes some entity</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>.../endentity{endentity_name}</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
<p   
><strong class=" ">Request Body</strong></p>
<p   
>As mentioned, some endpoints accept a request body containing the desired input data. Request bodies must only contain JSON formatted data and the header <strong class=" ">Content-Type: application/json</strong> must be set in the request for the request to be accepted. All input <strong class=" ">fields</strong> (not values) must be snake_case formatted, e.g. &quot;key_alg&quot; rather than &quot;keyAlg&quot; or &quot;key alg&quot;.</p>
<p   
>The following example shows a request to enroll a keystore (using cURL):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl -X POST -H </code><code class="string">'Content-Type: application/json'</code><code class="plain"> -i </code><code class="string">'https://localhost:8443/ejbca/ejbca-rest-api/v1/certificate/enrollkeystore'</code><code class="plain"> --data '{</code></div>
<div class="line"><code class="string">"username"</code><code class="plain">:</code><code class="string">"testUser"</code><code class="plain">,</code></div>
<div class="line"><code class="string">"password"</code><code class="plain">:</code><code class="string">"foo123"</code><code class="plain">,</code></div>
<div class="line"><code class="string">"key_alg"</code><code class="plain">:</code><code class="string">"RSA"</code><code class="plain">,</code></div>
<div class="line"><code class="string">"key_spec"</code><code class="plain">:</code><code class="string">"2048"</code></div>
<div class="line"><code class="plain">}'</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-Responsesresponses">
        <h3 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-responses" class="confluence-anchor-link"></span><span> Responses </span></h3>
<p   
>While integrating with the REST API, the most relevant information in the response is the status-line (HTTP status code), <strong class=" ">Content-Type</strong> header, and the response body.</p>
<p   
><strong class=" ">Status Codes</strong></p>
<p   
>Any response code within the range of 2xx - 3xx may be considered successful. This means that the server has accepted the request and sent an appropriate response. The typical response code from a GET request would be <strong class=" ">200 - OK</strong>. When the operation requires an approval by another administrator, the response will be <strong class=" ">201 - Accepted</strong>, meaning that the request has been accepted successfully and is awaiting approval.</p>
<p   
>Response codes in the range 4xx - 5xx should be considered errors. It may be an authentication failure, conflict or a general server error. For example, requesting an operation not allowed using your specific client certificate will generate <strong class=" ">403 - Unauthorized</strong>, most likely followed by some response message in the response body.</p>
<p   
>For a complete list of codes which may occur while interacting with the API, see <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-status_codes">Status Codes</a>.</p>
<p   
><strong class=" ">Response Body</strong></p>
<p   
>The content type of the response can be determined by the <strong class=" ">Content-Type</strong> header and most endpoints will always return <strong class=" ">application/json</strong>. Exceptions include for example calling <strong class=" ">.../ca/{issuer_dn}/certificate/download</strong> which returns a byte streamed .pem certificate. In this case, the wildcard header <strong class=" ">*/*</strong> is used. All requests regardless of response code, which reach the server will retrieve a response body. Any response to a successful request will contain a body including the requested information, for example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl -X GET -i </code><code class="string">'https://localhost:8443/ejbca/ejbca-rest-api/v1/certificate/CN%3DManagementCA%2CO%3DEJBCA%20Sample%2CC%3DSE/4b0b0ceb7a8e5f1f/revocationstatus'</code></div>
</div>
    </div>
<p   
>Returns the following JSON body (given that the certificate is found):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"issuer_dn"</code><code class="plain">: </code><code class="string">"CN=ManagementCA,O=EJBCA Sample,C=SE"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"serial_number"</code><code class="plain">: </code><code class="string">"4b0b0ceb7a8e5f1f"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"revocation_reason"</code><code class="plain">: </code><code class="string">"KEY_COMPROMISE"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"revocation_date"</code><code class="plain">: </code><code class="string">"2018-06-27T08:07:52Z"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"revoked"</code><code class="plain">: </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>In the event of an error, a response body containing the status code (in addition to the header), and an appropriate error message is returned.</p>
<p   
>For example, if the request above was done for a CA which does not exist, the client could expect a response like:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"error_code"</code><code class="plain">: </code><code class="value">404</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"error_message"</code><code class="plain">: </code><code class="string">"CA 'CN=NonExistingCA,O=EJBCA Sample,C=SE' does not exist."</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>If a completely unexpected error occurs, the server will respond with <strong class=" ">500 - General failure</strong>. If this occurs, verify the content of the request and next require that the CA Administrator checks the server log.</p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-Authenticationauthentication">
        <h1 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-authentication" class="confluence-anchor-link"></span><span>Authentication </span></h1>
<p   
>The REST API requires client certificate authentication from administrators just as the Admin GUI does. If you have a working Admin GUI client certificate, you should also be able to use it for the REST API. How the certificate is passed with the request depends on your integration environment. To verify server response and authentication, attempt accessing the API through any web browser using your client certificate:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">https:</code><code class="comments">//[DOMAIN_NAME]:[PORT]/ejbca/ejbca-rest-api/v1/ca/version</code></div>
</div>
    </div>
<p   
>You can also use cURL <i class=" ">o</i>r a similar tool by specifying --cert and --key.</p>
<p   
>If no certificate or an invalid certificate is provided, you'll most likely be presented with a &quot;Bad certificate&quot; error. However, if an attempt is made to request a resource above the privileges of a valid certificate, the response will contain a JSON formatted response body with the status code <strong class=" ">403 - Unauthorized</strong> followed by an appropriate response message. For more information, see <a   href="#src-100270321_id-.EJBCARESTInterfacev7.4.3-status_codes">Status Codes</a>.</p>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-DebuggingRESTAPIdebugging_rest_api">
        <h1 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-debugging_rest_api" class="confluence-anchor-link"></span><span>Debugging REST API </span></h1>
<p   
>By default, EJBCA logs basic information about incoming requests and INFO level.</p>
<p   
>The following info is logged in INFO logging level:</p>
<ul class=" "><li class=" "><p   
>remote address</p>
</li><li class=" "><p   
>&quot;X-Forwarded-For&quot; header value</p>
</li></ul><p   
>Example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="value">13</code><code class="plain">:</code><code class="value">31</code><code class="plain">:</code><code class="value">07</code><code class="plain">,</code><code class="value">976</code><code class="plain"> INFO [org.ejbca.ui.web.rest.api.config.RestLoggingFilter] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">10</code><code class="plain">) GET https:</code><code class="comments">//localhost:8443/ejbca/ejbca-rest-api/v1/ca/CN=Management%20CA,O=PK,C=SE/certificate/download received from 127.0.0.1 X-Forwarded-For: null</code></div>
</div>
    </div>
<p   
>It is also possible to make EJBCA log the complete requests and responses at TRACE level.</p>
<p   
>The following info is logged in TRACE level:</p>
<ul class=" "><li class=" "><p   
>request and response</p>
</li><li class=" "><p   
>time taken per request, i.e. endtime - starttime</p>
</li></ul><p   
>As enabling TRACE logging globally, for all of EJBCA, may result in excessive logging, it is possible to enable it for the <i class=" ">RestLoggingFilter</i> only. On JBoss/WildFly this is done with simple commands in the jboss-cli:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem=logging/logger=org.ejbca.ui.web.rest.api.config:add</code></div>
<div class="line"><code class="plain">/subsystem=logging/logger=org.ejbca.ui.web.rest.api.config:write-attribute(name=level, value=TRACE) </code></div>
</div>
    </div>
<p   
>Example TRACE logging for a simple request is:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl -X GET </code><code class="string">"https://localhost:8443/ejbca/ejbca-rest-api/v1/ca/CN=Management%20CA,O=PK,C=SE/certificate/download"</code><code class="plain"> --insecure --cert cert-superadmin.pem --key key-superadmin.pem</code></div>
</div>
    </div>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="value">2018</code><code class="plain">-</code><code class="value">08</code><code class="plain">-</code><code class="value">07</code><code class="plain"> </code><code class="value">13</code><code class="plain">:</code><code class="value">31</code><code class="plain">:</code><code class="value">08</code><code class="plain">,</code><code class="value">038</code><code class="plain"> TRACE [org.ejbca.ui.web.rest.api.config.RestLoggingFilter] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">10</code><code class="plain">) GET https:</code><code class="comments">//localhost:8443/ejbca/ejbca-rest-api/v1/ca/CN=Management%20CA,O=PK,C=SE/certificate/download received from 127.0.0.1 X-Forwarded-For: null</code></div>
<div class="line"><code class="plain">Request headers:</code></div>
<div class="line"><code class="plain">  Accept: */*</code></div>
<div class="line"><code class="plain">  User-Agent: curl/</code><code class="value">7.47</code><code class="plain">.</code><code class="value">0</code></div>
<div class="line"><code class="plain">  Host: localhost:</code><code class="value">8443</code></div>
<div class="line"><code class="plain">Request data:</code></div>
<div class="line"><code class="plain">  </code></div>
<div class="line"><code class="plain">Response data:</code></div>
<div class="line"><code class="plain">Subject: CN=Management CA,O=PK,C=SE</code></div>
<div class="line"><code class="plain">Issuer: CN=Management CA,O=PK,C=SE</code></div>
<div class="line"><code class="plain">-----BEGIN CERTIFICATE-----</code></div>
<div class="line"><code class="plain">MIIDTzCCAjegAwIBAgIIbbifeqpPKLcwDQYJKoZIhvcNAQELBQAwNTEWMBQGA1UE</code></div>
<div class="line"><code class="plain">&lt;snip&gt;</code></div>
<div class="line"><code class="plain">xdd9ycYOyym2nvM+SPydHlK8dAqwwXzICFFOCRADsQNakVU=</code></div>
<div class="line"><code class="plain">-----END CERTIFICATE-----</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">Time taken: 62ms</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-StatusCodesstatus_codes">
        <h1 class="heading "><span id="src-100270321_id-.EJBCARESTInterfacev7.4.3-status_codes" class="confluence-anchor-link"></span><span>Status Codes </span></h1>
<p   
>API status codes are exposed in standard HTTP response codes and JSON formatted messages. For example, the following example shows an HTTP 403 error:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"error_code"</code><code class="plain">: </code><code class="value">403</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"error_message"</code><code class="plain">: </code><code class="string">"Not authorized to resource /administrator."</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>The response code will also be available in the HTTP response status-line. The following table describes status codes which may be &quot;expected&quot; responses from the REST API and a few possible reasons.</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>HTTP Status Code</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>General Description</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>EJBCA REST API Context</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>200</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>OK</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Successful HTTP request, expect a proper response body. Typically received from a successful GET request.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>201</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Created</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Successful HTTP request. Some entity has been created, e.g. certificate enrolled. Typically received after a successful POST request.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>202</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Accepted</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Request accepted by the server but awaiting processing. Most likely waiting for administrator approval.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>400</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Bad Request</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Most likely missing or invalid input parameters / JSON body in the request.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>403</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Forbidden</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Request accepted but the operation is refused due to insufficient privileges, disabled features etc.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>404</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Not Found</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Requested entity was not found by EJBCA. Could occur if the input refers to a non-existing entity, such as a user or a CA.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>409</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Conflict</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Conflict occurred while processing request, e.g. trying to revoke an already revoked certificate.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>413</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Payload Too Large</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The request is larger than the server is willing to process. Should not occur while using the API as intended.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>422</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Unprocessable Entity</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Well-formed request but unable to process due to e.g. semantic errors. Could occur in case of invalid key algorithm, validity etc.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>500</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Internal Server Error</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Unexpected error while calling the API. For additional details, refer to the server log (CA Administrator).</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>503</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Service Unavailable</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Possible reason could be that the CA is offline, CT log is unavailable etc.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-Examples">
        <h1 class="heading "><span>Examples</span></h1>
    <div class="section section-2" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-GenerateaCSRandRequestaCertificateusingBash">
        <h2 class="heading "><span>Generate a CSR and Request a Certificate using Bash</span></h2>
<p   
>You can use OpenSSL, jq, and cURL (    <span style="color: #333333;">
version &gt;7.57)    </span>
 to create a key and a CSR, create a JSON payload containing the CSR, and then enroll for a TLS server certificate using the configuration file and script below.</p>
    <div class="section section-3" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-ConfigurationFileExample">
        <h3 class="heading "><span>Configuration File Example </span></h3>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">csr.conf</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="csr.conf" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="plain">[req]</code></div>
<div class="line"><code class="plain">distinguished_name = req_distinguished_name</code></div>
<div class="line"><code class="plain">req_extensions = v3_req</code></div>
<div class="line"><code class="plain">prompt = no</code></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><code class="plain">[req_distinguished_name]</code></div>
<div class="line"><code class="plain">C = SE</code></div>
<div class="line"><code class="plain">O = PrimeKey Solutions AB</code></div>
<div class="line"><code class="plain">OU = Infra</code></div>
<div class="line"><code class="plain">CN = primekey.com</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">[v3_req]</code></div>
<div class="line"><code class="plain">keyUsage = keyEncipherment, digitalSignature</code></div>
<div class="line"><code class="plain">extendedKeyUsage = serverAuth</code></div>
<div class="line"><code class="plain">subjectAltName = </code><code class="color1">@alt_names</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">[alt_names]</code></div>
<div class="line"><code class="plain">DNS.</code><code class="value">1</code><code class="plain"> = primekey.com</code></div>
</div>
    </div>
    </div>
    <div class="section section-3" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-ScriptExample">
        <h3 class="heading "><span>Script Example</span></h3>
<p   
>The pkcs10enroll.sh script generates a new CSR if one does not already exist, requests a certificate from EJBCA, and then prints the JSON response to stdout.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">pkcs10enroll.sh</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="pkcs10enroll.sh" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="comments">#!/bin/sh</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># Before running this script you need to do the following:</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># 1. If you are contacting the CA directly:</code></div>
<div class="line"><code class="comments">#</code></div>
<div class="line"><code class="comments">#     Enable the REST API in System Configuration -&gt; Protocol Configuration.</code></div>
<div class="line"><code class="comments">#</code></div>
<div class="line"><code class="comments">#     If you are contacting an external RA, you should enable the REST API for</code></div>
<div class="line"><code class="comments">#     the peer role on the CA.</code></div>
<div class="line"> </div>
<div class="line"><code class="functions">hostname</code><code class="plain">=</code><code class="string">"172.16.31.14"</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># 2. Specify profiles, CA and end entity to use for issuance</code></div>
<div class="line"><code class="comments">#</code></div>
<div class="line"><code class="comments">#     Enable 'Allow Subject DN Override by CSR' in the certificate profile</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">cert_profile_name=</code><code class="string">"staging-cert"</code></div>
<div class="line"><code class="plain">ee_profile_name=</code><code class="string">"staging-ee"</code></div>
<div class="line"><code class="plain">ca_name=</code><code class="string">"Issuing CA"</code></div>
<div class="line"><code class="comments"># This user will be created if it does not exist. The status of an existing</code></div>
<div class="line"><code class="comments"># end entity will be set to NEW automatically.</code></div>
<div class="line"><code class="plain">username=</code><code class="string">"pkcs10enroll_user"</code></div>
<div class="line"><code class="comments"># If the user already exists, specify the enrollment code here</code></div>
<div class="line"><code class="plain">enrollment_code=</code><code class="string">"foo123"</code></div>
<div class="line"> </div>
<div class="line"><code class="comments"># 3. Adjust the variable $client_cert to point to a client certificate.</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">client_cert=</code><code class="string">"/opt/jboss/p12/SuperAdmin.p12:foo123"</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">if</code><code class="plain"> [ ! -f </code><code class="string">'server.csr'</code><code class="plain"> ]; </code><code class="keyword">then</code></div>
<div class="line"><code class="plain">    openssl req -new -out server.csr -newkey rsa:2048 \</code></div>
<div class="line"><code class="plain">	    -nodes -sha256 -keyout server.key \</code></div>
<div class="line"><code class="plain">	    -config csr.conf &gt; </code><code class="plain">/dev/null</code><code class="plain"> 2&gt;&amp;1</code></div>
<div class="line"><code class="keyword">fi</code></div>
<div class="line"><code class="plain">csr=$(</code><code class="functions">cat</code><code class="plain"> server.csr)</code></div>
<div class="line"><code class="plain">template=</code><code class="string">'{"certificate_request":$csr, "certificate_profile_name":$cp, "end_entity_profile_name":$eep, "certificate_authority_name":$ca, "username":$ee, "password":$pwd}'</code></div>
<div class="line"><code class="plain">json_payload=$(jq -n \</code></div>
<div class="line"><code class="plain">    --arg csr </code><code class="string">"$csr"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    --arg </code><code class="functions">cp</code><code class="plain"> </code><code class="string">"$cert_profile_name"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    --arg eep </code><code class="string">"$ee_profile_name"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    --arg ca </code><code class="string">"$ca_name"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    --arg ee </code><code class="string">"$username"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    --arg </code><code class="functions">pwd</code><code class="plain"> </code><code class="string">"$enrollment_code"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    </code><code class="string">"$template"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">curl -X POST -s \</code></div>
<div class="line"><code class="plain">    --cert-</code><code class="functions">type</code><code class="plain"> P12 \</code></div>
<div class="line"><code class="plain">    --cert </code><code class="string">"$client_cert"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    -H </code><code class="string">'Content-Type: application/json'</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    --data </code><code class="string">"$json_payload"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    </code><code class="string">"https://$hostname/ejbca/ejbca-rest-api/v1/certificate/pkcs10enroll"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">    | jq .</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-2" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-RevocationWorkflowExample">
        <h2 class="heading "><span>Revocation Workflow Example</span></h2>
<p   
>Follow the example below to first check the revocation status of a certificate and then revoke the certificate.</p>
<p   
>In this example, the certificate's DN is <strong class=" ">CN=CA1</strong> and serial number (in HEX) is <strong class=" ">5CB3D42686039768D973E5694BF205377AF6</strong>.</p>
<ol class=" "><li class=" "><p   
>To check the revocation status of the certificate, call the <tt class=" ">GET /v1/certificate/{issuer_dn}/{certificate_serial_number}/revocationstatus</tt> REST method:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl -X GET -s \</code></div>
<div class="line"><code class="plain">--cert-type P12 \</code></div>
<div class="line"><code class="plain">--cert </code><code class="string">"/opt/jboss/p12/SuperAdmin.p12:foo123"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">-H </code><code class="string">"accept: application/json"</code></div>
<div class="line"><code class="string">"https://localhost:8443/ejbca/ejbca-rest-api/v1/certificate/CN%3DCA1/5CB3D42686039768D973E5694BF205377AF6/revocationstatus"</code></div>
</div>
    </div>
</li><li class=" "><p   
>From the response below, you can confirm that the certificate is active.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="string">"issuer_dn"</code><code class="plain">: </code><code class="string">"CN=CA1"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"serial_number"</code><code class="plain">: </code><code class="string">"5CB3D42686039768D973E5694BF205377AF6"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"revocation_reason"</code><code class="plain">: </code><code class="string">"NOT_REVOKED"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"revoked"</code><code class="plain">: </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p   
>To revoke the certificate, call the <tt class=" ">PUT /v1/certificate/{issuer_dn}/{certificate_serial_number}/revoke</tt> REST method:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl -X PUT -s \</code></div>
<div class="line"><code class="plain">--cert-type P12 \</code></div>
<div class="line"><code class="plain">--cert </code><code class="string">"/opt/jboss/p12/SuperAdmin.p12:foo123"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">-H </code><code class="string">"accept: application/json"</code></div>
<div class="line"><code class="string">"https://localhost:8443/ejbca/ejbca-rest-api/v1/certificate/CN%3DCA1/5CB3D42686039768D973E5694BF205377AF6/revoke?reason=KEY_COMPROMISE"</code></div>
</div>
    </div>
</li><li class=" "><p   
>Confirm from the response that the certificate has been successfully revoked:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="string">"issuer_dn"</code><code class="plain">: </code><code class="string">"CN=HT_REMOVAL_CA"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"serial_number"</code><code class="plain">: </code><code class="string">"5CB3D42686039768D973E5694BF205377AF6"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"revocation_reason"</code><code class="plain">: </code><code class="string">"KEY_COMPROMISE"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"revocation_date"</code><code class="plain">: </code><code class="string">"2019-05-27T15:02:56Z"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"message"</code><code class="plain">: </code><code class="string">"Successfully revoked"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	</code><code class="string">"revoked"</code><code class="plain">: </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li></ol>    </div>
    <div class="section section-2" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-RequestaPKCS12CertificateUsingPython">
        <h2 class="heading "><span>Request a PKCS12 Certificate Using Python</span></h2>
<p   
>To request a PKCS12 certificate using python, do the following:</p>
<ol class=" "><li class=" "><p   
>Install the module <a  class="external-link" href="https://pypi.org/project/requests-pkcs12/">requests_pkcs12</a> using pip.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">pip3 </code><code class="functions">install</code><code class="plain"> requests_pkcs12</code></div>
</div>
    </div>
</li><li class=" "><p   
>Authenticate with the client certificate stored in <tt class=" ">superadmin.p12</tt> and request a PKCS12 file for the end entity <i class=" ">python</i>.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="true" data-firstline="1">
<div class="line"><code class="keyword">import</code><code class="plain"> json</code></div>
<div class="line"><code class="keyword">from</code><code class="plain"> requests_pkcs12 </code><code class="keyword">import</code><code class="plain"> post</code></div>
<div class="line"><code class="plain">response </code><code class="keyword">=</code><code class="plain"> post(</code><code class="string">'https://myca:8443/ejbca/ejbca-rest-api/v1/certificate/enrollkeystore'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    json</code><code class="keyword">=</code><code class="plain">{</code></div>
<div class="line"><code class="plain">        </code><code class="string">'username'</code><code class="plain">: </code><code class="string">'python'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        </code><code class="string">'password'</code><code class="plain">: </code><code class="string">'foo123'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        </code><code class="string">'key_alg'</code><code class="plain">: </code><code class="string">'RSA'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        </code><code class="string">'key_spec'</code><code class="plain">: </code><code class="string">'2048'</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    headers</code><code class="keyword">=</code><code class="plain">{ </code></div>
<div class="line"><code class="plain">        </code><code class="string">'content-type'</code><code class="plain">: </code><code class="string">'application/json'</code><code class="plain"> </code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    pkcs12_filename</code><code class="keyword">=</code><code class="string">'/srv/superadmin.p12'</code><code class="plain">, </code></div>
<div class="line"><code class="plain">    pkcs12_password</code><code class="keyword">=</code><code class="string">'foo123'</code><code class="plain">, </code></div>
<div class="line"><code class="plain">    verify</code><code class="keyword">=</code><code class="string">'/srv/truststore.pem'</code><code class="plain">)</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">print</code><code class="plain">(json.dumps(json.loads(response.content), indent</code><code class="keyword">=</code><code class="value">4</code><code class="plain">, sort_keys</code><code class="keyword">=</code><code class="color1">True</code><code class="plain">))</code></div>
</div>
    </div>
</li></ol>    </div>
    <div class="section section-2" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-SearchforCertificates">
        <h2 class="heading "><span>Search for Certificates</span></h2>
<p   
>To search for certificates with multiple search criteria, use the <strong class=" ">search</strong> method.</p>
    <div class="section section-3" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-ExampleSearchRequests">
        <h3 class="heading "><span>Example Search Requests</span></h3>
    <div class="section section-4" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-ExampleJSONsearchrequest">
        <h4 class="heading "><span>Example JSON search request</span></h4>
<p   
>The following shows an example JSON search request to search for <strong class=" ">ACTIVE</strong> certificates for the <strong class=" ">superadmin</strong> user, limiting the search to return a maximum of <strong class=" ">10</strong> certificates:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"max_number_of_results"</code><code class="plain">: </code><code class="value">10</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"criteria"</code><code class="plain">: [</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"property"</code><code class="plain">: </code><code class="string">"QUERY"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"value"</code><code class="plain">: </code><code class="string">"superadmin"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"operation"</code><code class="plain">: </code><code class="string">"EQUAL"</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"property"</code><code class="plain">: </code><code class="string">"STATUS"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"value"</code><code class="plain">: </code><code class="string">"CERT_ACTIVE"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"operation"</code><code class="plain">: </code><code class="string">"EQUAL"</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  ]</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>To search for DN or altName fields, for example, looking for a maximum of 10 certificates issued to a user with Common Name like 'Firstname Lastname', use the following:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"max_number_of_results"</code><code class="plain">: </code><code class="value">10</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"criteria"</code><code class="plain">: [</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"property"</code><code class="plain">: </code><code class="string">"QUERY"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"value"</code><code class="plain">: </code><code class="string">"Firstname Lastname"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"operation"</code><code class="plain">: </code><code class="string">"LIKE"</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"property"</code><code class="plain">: </code><code class="string">"STATUS"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"value"</code><code class="plain">: </code><code class="string">"CERT_ACTIVE"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">      </code><code class="string">"operation"</code><code class="plain">: </code><code class="string">"EQUAL"</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  ]</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-4" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-ExamplecURLsearchcommand">
        <h4 class="heading "><span>Example cURL search command</span></h4>
<p   
>The following shows an example cURL command to search for <strong class=" ">ACTIVE</strong> certificates for the <strong class=" ">superadmin</strong> user, limiting the search to return a maximum of <strong class=" ">10</strong> certificates:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">curl -X POST </code><code class="string">"https://localhost:8443/ejbca/ejbca-rest-api/v1/certificate/search"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">-H  </code><code class="string">"accept: application/json"</code><code class="plain"> -H  </code><code class="string">"Content-Type: application/json"</code><code class="plain"> \</code></div>
<div class="line"><code class="plain">-d </code><code class="string">"{  \"max_number_of_results\": 10,  \"criteria\": [    {      \"property\": \"QUERY\",      \"value\": \"tomastest1.primekey.com\",      \"operation\": \"EQUAL\"    },    {      \"property\": \"STATUS\",      \"value\": \"CERT_ACTIVE\",      \"operation\": \"EQUAL\"    }  ]}"</code></div>
</div>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-100270321_id-.EJBCARESTInterfacev7.4.3-Troubleshooting">
        <h1 class="heading "><span>Troubleshooting</span></h1>
<p   
>An exception like the following may be caused by an encoding issue:</p>
    <div  class="confbox programlisting">
                <div class="content">
        <pre><code>IOException while decoding certificate request from PEM: -----END CERTIFICATE REQUEST</code></pre>
        </div>
    </div>
<p   
>The issue can be resolved by manually replacing the linebreaks with <tt class=" ">\n</tt>.</p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Certificate_Store_Access_via_HTTP.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Certificate Store Access via HTTP</span>
        </a>
                <a href="CMP.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>CMP</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
