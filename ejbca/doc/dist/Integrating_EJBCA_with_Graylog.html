<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Integrating EJBCA with Graylog - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=85922510"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Integration.html">EJBCA Integration</a></li>
                                                                                     <li><a href="Integrating_with_Third-Party_Applications.html">Integrating with Third-Party Applications</a></li>
                                                            </ul>
</div>            <h1 id="src-85922510"> <span>Integrating EJBCA with Graylog</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
><a  class="external-link" href="https://www.graylog.org/">Graylog</a> can consume syslog, and other log formats. The following sections list steps required to send syslog traffic to Graylog and configure it to visualize some interesting statistics.</p>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-InstallGraylog">Install Graylog</a></p>
</li><li class=" "><p   
><a   href="#src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-RelatedContent">Related Content</a></p>
</li></ul>    <div class="section section-1" id="src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-InstallGraylog">
        <h1 class="heading "><span>Install Graylog</span></h1>
<p   
>The first step is to install Graylog. You can get started quickly for testing by starting up a machine in AWS using the AMI, using the OVA VM, or using Docker containers. For more information, refer to the Graylog documentation on <a  class="external-link" href="http://docs.graylog.org/en/2.4/pages/getting_started/download_install.html">Download &amp; Install Graylog</a>.</p>
    <div class="section section-2" id="src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-EnableSyslogTCPinput">
        <h2 class="heading "><span>Enable Syslog TCP input</span></h2>
<p   
>This example uses syslog over TCP. To enable using syslog TCP input in Graylog, do the following:</p>
<ol class=" "><li class=" "><p   
>Go to the Graylog Web Console and select <strong class=" ">System &gt; Input</strong>.</p>
</li><li class=" "><p   
>Select <strong class=" ">Syslog TCP</strong> in the <strong class=" ">Select Input</strong> list-menu and click <strong class=" ">Launch new input</strong>.</p>
</li></ol>    </div>
    <div class="section section-2" id="src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-ConfigureEJBCALogging">
        <h2 class="heading "><span>Configure EJBCA Logging</span></h2>
<p   
>On the EJBCA server, configure WildFly to send messages to Graylog with syslog TCP. This is done by adding the following section in the logging subsystem in the JBoss/WildFly <tt class=" ">standalone.xml:</tt></p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">syslog</code><code class="plain">-handler </code><code class="color1">name</code><code class="plain">=</code><code class="string">"SYSLOGTCP"</code><code class="plain"> </code><code class="color1">enabled</code><code class="plain">=</code><code class="string">"true"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">level</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"INFO"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">hostname</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"my.host"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">app</code><code class="plain">-name </code><code class="color1">value</code><code class="plain">=</code><code class="string">"WildFly"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">server</code><code class="plain">-address </code><code class="color1">value</code><code class="plain">=</code><code class="string">"my.graylog.server"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">port</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"514"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">facility</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"local-use-1"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">syslog</code><code class="plain">-handler&gt;</code></div>
</div>
    </div>
<p   
>You also need to configure the root-logger to use the new handler, this will start sending the same logs to syslog. Add the new handler by modifying the root-loggers section in <tt class=" ">standalone.xml:</tt></p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">root</code><code class="plain">-logger&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">level</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"INFO"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">handlers</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">        &lt;</code><code class="keyword">handler</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CONSOLE"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">        &lt;</code><code class="keyword">handler</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"FILE"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">        &lt;</code><code class="keyword">handler</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"SYSLOGTCP"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;/</code><code class="keyword">handlers</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">root</code><code class="plain">-logger&gt;</code></div>
</div>
    </div>
<p   
>You can limit the logging further to only include the audit log, by configuring to only send events from <tt class=" ">org.cesecore.audit.impl.log4j.Log4jDevice</tt> to the syslog handler. This may be good if your main interest is statistics, but you will then miss things like Exceptions in the log.</p>
<p   
>Send some log items by performing an action in the EJBCA Admin UI, for example saving a certificate profile.</p>
    </div>
    <div class="section section-2" id="src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-CreateGraylogExtractors">
        <h2 class="heading "><span>Create Graylog Extractors</span></h2>
<p   
>Graylog <i class=" ">Extractors</i> are used to extract fields, that can be used in queries in Graylog, from the log stream. Create extractors for your log input under <strong class=" ">System &gt; Input</strong> in the Graylog Web Console.</p>
<p   
>You can analyze log items and create the extractors you need. In our example, the following extractors are created:</p>
<ul class=" "><li class=" "><p   
>RADN: An administrators DN who issued a certificate, for example 'CN=RA Admin,O=PrimeKey,C=SE'</p>
<ul class=" "><li class=" "><p   
>Extractor type: Split &amp; Index</p>
</li><li class=" "><p   
>Split by: ;</p>
</li><li class=" "><p   
>Target index: 6</p>
</li></ul></li><li class=" "><p   
>EVENT: The event that happened, for example 'CERT_CREATION'</p>
<ul class=" "><li class=" "><p   
>Extractor type: Split &amp; Index</p>
</li><li class=" "><p   
>Split by: ;</p>
</li><li class=" "><p   
>Target index: 2</p>
</li></ul></li><li class=" "><p   
>CERTPROFILE: the certificate profile a certificate was issued for, for example 'certprofile=346136222'</p>
<ul class=" "><li class=" "><p   
>Extractor type: Split &amp; Index</p>
</li><li class=" "><p   
>Split by: ;</p>
</li><li class=" "><p   
>Target index: 11</p>
</li></ul></li><li class=" "><p   
>CERT: the certificate issued, for example 'cert=MIIE1DCCArygAw...'</p>
<ul class=" "><li class=" "><p   
>Extractor type: Split &amp; Index</p>
</li><li class=" "><p   
>Split by: ;</p>
</li><li class=" "><p   
>Target index: 13</p>
</li><li class=" "><p   
>Condition: Only attempt extraction if field contains string 'cert='</p>
</li></ul></li><li class=" "><p   
>SUBJECTDN: the subject DN a certificate is issued to, for example 'subjectdn=CN=<a  class="external-link" href="http://tomastest3.primekey.com/">T</a>est1 test'</p>
<ul class=" "><li class=" "><p   
>Extractor type: Split &amp; Index</p>
</li><li class=" "><p   
>Split by: ;</p>
</li><li class=" "><p   
>Target index: 10</p>
</li><li class=" "><p   
>Condition: Only attempt extraction if field contains string 'subjectdn='</p>
</li></ul></li></ul><p   
>You can edit and create extractors of many different types, the above are simple examples.</p>
<p  class="tw-data-text tw-ta tw-text-small" 
>Once the extractors have been created, go to EJBCA and make some actions to log something you want to     <span style="color: #000000;">
visualize. For example, running the stresstest <i class=" ">clientToolBox stress</i> to issue a bunch of certificates, by different RAs.    </span>
</p>
    </div>
    <div class="section section-2" id="src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-CreateGraylogDashboard">
        <h2 class="heading "><span>Create Graylog Dashboard</span></h2>
<p   
>Graylog dashboards allow you to build pre-defined views and visualize your data.</p>
<p   
>To create a new Graylog Dashboard, do the following:</p>
<ol class=" "><li class=" "><p   
>Go to the Dashboards section and click <strong class=" ">Create dashboard</strong> to create a new dashboard called <strong class=" ">EJBCA stats</strong>.</p>
</li><li class=" "><p   
>Go to <strong class=" ">Search</strong> and create some searches for your dashboard.</p>
</li></ol>    <div class="section section-3" id="src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-AddandVisualizeSearchesonDashboard">
        <h3 class="heading "><span>Add and Visualize Searches on Dashboard</span></h3>
<p   
>The following provides examples of search result information that you can add to your dashboard. This screenshot displays a dashboard with the search examples added and shows some sample test data:</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/85922510/graylog2.png" alt="images/download/attachments/85922510/graylog2.png"  height="250" />
    </p>
<p   
>Note that the examples may not suit your needs. For example, searching for <strong class=" ">all time</strong> may not be suitable if you have very large datasets, and will not give correct numbers if you start using Graylog when you have already run EJBCA for a while (thus it will not show <strong class=" ">all time</strong> since EJBCA was installed).</p>
<p   
>Examples of search result information to visualize:</p>
<ul class=" "><li class=" "><p   
>CERT_CREATION last day</p>
<ul class=" "><li class=" "><p   
>Search in the last 1 day</p>
</li><li class=" "><p   
>EVENT:CERT_CREATION</p>
</li><li class=" "><p   
>Click <strong class=" ">Add count to dashboard</strong></p>
</li></ul></li><li class=" "><p   
>CERT_REVOKED last day</p>
<ul class=" "><li class=" "><p   
>Search in the last 1 day</p>
</li><li class=" "><p   
>EVENT:CERT_REVOKED</p>
</li><li class=" "><p   
>Click <strong class=" ">Add count to dashboard</strong></p>
</li></ul></li><li class=" "><p   
>Certs issued by SuperAdmin all time</p>
<ul class=" "><li class=" "><p   
>Search in all messages</p>
</li><li class=" "><p   
>EVENT:CERT_CREATION AND RADN:CN=SuperAdmin</p>
</li><li class=" "><p   
>Click <strong class=" ">Add count to dashboard</strong></p>
</li></ul></li><li class=" "><p   
>Certs per RA</p>
<ul class=" "><li class=" "><p   
>Search in all messages</p>
</li><li class=" "><p   
>EVENT:CERT_CREATION</p>
</li><li class=" "><p   
>Select <strong class=" ">RADN</strong> and click to expand, click <strong class=" ">Quick values</strong>, and then <strong class=" ">Add to dashboard </strong>when you see the graph.</p>
</li></ul></li><li class=" "><p   
>Certs issued per day</p>
<ul class=" "><li class=" "><p   
>Search in the last 30 days</p>
</li><li class=" "><p   
>EVENT:CERT_CREATION</p>
</li><li class=" "><p   
>Select <strong class=" ">Day</strong> in the Histogram and then click <strong class=" ">Add to dashboard</strong></p>
</li></ul></li><li class=" "><p   
>Exceptions last week</p>
<ul class=" "><li class=" "><p   
>Search in the last 7 days</p>
</li><li class=" "><p   
>Exception</p>
</li><li class=" "><p   
>Select <strong class=" ">Hour</strong> in the Histogram and then click <strong class=" ">Add to dashboard</strong></p>
</li></ul></li></ul><p   
>You can now go to your dashboard and rearrange the widgets using <strong class=" ">Unlock/Edit.</strong></p>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-85922510_id-.IntegratingEJBCAwithGraylogv7.4.0-RelatedContent">
        <h1 class="heading "><span>Related Content</span></h1>
<ul class=" "><li class=" "><p   
><a   href="Logging.html">Logging in EJBCA</a></p>
</li></ul>    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Subordinate_HashiCorp_Vault_CA_to_EJBCA_Root.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Subordinate HashiCorp Vault CA to EJBCA Root</span>
        </a>
                <a href="Issuing_Certificates_to_Kubernetes_Services_using_cert-manager.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Issuing Certificates to Kubernetes Services using cert-manager</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
