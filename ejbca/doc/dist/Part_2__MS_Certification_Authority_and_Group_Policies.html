<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Part 2: MS Certification Authority and Group Policies - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=85924705"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Integration.html">EJBCA Integration</a></li>
                                                                                                         <li class="shortcut"><a href="Integrating_with_Third-Party_Applications.html">Integrating with Third-Party Applications</a></li>
                                                                                     <li><a href="Auto_Enrollment_Configuration_Guide.html">Auto Enrollment Configuration Guide</a></li>
                                                            </ul>
</div>            <h1 id="src-85924705"> <span>Part 2: MS Certification Authority and Group Policies</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>The following sections cover how to install and configure the Microsoft Certification Authority and Group Policies:</p>
<ul class=" "><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDEtSW5zdGFsbEFjdGl2ZURpcmVjdG9yeUNlcnRpZmljYXRlU2VydmljZXM">Step 1 - Install Active Directory Certificate Services</a></p>
</li><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDItQ29uZmlndXJlQWN0aXZlRGlyZWN0b3J5Q2VydGlmaWNhdGVFbnJvbGxtZW50UG9saWN5U2VydmljZXM">Step 2 - Configure Active Directory Certificate Enrollment Policy Services</a></p>
</li><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDMtQ29uZmlndXJlQ2VydGlmaWNhdGVUZW1wbGF0ZXM">Step 3 - Configure Certificate Templates</a></p>
</li><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDQtQ29uZmlndXJlSUlT">Step 4 - Configure IIS</a></p>
</li><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDUtQ29uZmlndXJlR3JvdXBQb2xpY2llc29uQURzZXJ2ZXI">Step 5 - Configure Group Policies on AD server</a></p>
</li><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDYtVGVzdE1pY3Jvc29mdEF1dG9FbnJvbGxtZW50">Step 6 - Test Microsoft Auto Enrollment</a></p>
</li><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDctVXBkYXRlTVNBdXRvRW5yb2xsbWVudFNlcnZlclVSTA">Step 7 - Update MS Auto Enrollment Server URL</a></p>
</li><li class=" "><p   
><a   href="#src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDgtVXBkYXRlR3JvdXBQb2xpY3lmb3JDZXJ0aWZpY2F0ZUVucm9sbG1lbnQ">Step 8 - Update Group Policy for Certificate Enrollment</a></p>
</li></ul><p   
>    <span style="color: #000000;">
The examples below use the following denotations:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #000000;">
The domain used is <strong class=" ">yourcompany.com (YOURCOMPANY)</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
The Certificate Services hostname is <strong class=" ">csserver</strong>.yourcompany.com.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
The Tomcat server hostname is <strong class=" ">tomcatserver</strong>.yourcompany.com.    </span>
</p>
</li></ul><p   
>    <span style="color: #000000;">
Labels indicated in bold should be replaced with the names of your environment and in the examples below, the text enclosed in angle brackets should be replaced with names in your environment.    </span>
</p>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDEtSW5zdGFsbEFjdGl2ZURpcmVjdG9yeUNlcnRpZmljYXRlU2VydmljZXM">
        <h1 class="heading "><span>Step 1 - Install Active Directory Certificate Services</span></h1>
<p   
>    <span style="color: #000000;">
The following covers instructions for how to install and configure Active Directory (AD) Certificate Services.    </span>
</p>
    <div class="section section-2" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtSW5zdGFsbEFjdGl2ZURpcmVjdG9yeUNlcnRpZmljYXRlU2VydmljZXM">
        <h2 class="heading "><span>Install Active Directory Certificate Services</span></h2>
<p   
>    <span style="color: #000000;">
To install Active Directory Certificate Services:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Assign a static IP address for this host.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Give the host an appropriate computer name (&lt;<strong class=" ">csserver</strong>&gt;).    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Add the host member of the domain (<strong class=" ">yourcompany.com</strong>) using an account that belongs to the Domain/Enterprise Admin group.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Open the Server Manager.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Add roles and features</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Role-based or feature-based installation</strong> and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Sele<i class=" ">c</i>t <strong class=" ">Select a server from the server pool</strong>, select this server, and then click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Active Directory Certificate Services</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
When prompted to add required features, click <strong class=" ">Add Features</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Proceed until reaching the <strong class=" ">Role Services</strong> page.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Certification Authority</strong> and <strong class=" ">Certification Authority Web Enrollment</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
In the appearing popup panel, click <strong class=" ">Add Features</strong> to add IIS and its corresponding features.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Proceed until the Confirmation page and click <strong class=" ">Install</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
When the installation completes, click <strong class=" ">Close</strong>.    </span>
</p>
</li></ol>    </div>
    <div class="section section-2" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtQ29uZmlndXJlQWN0aXZlRGlyZWN0b3J5Q2VydGlmaWNhdGVTZXJ2aWNlcw">
        <h2 class="heading "><span>Configure Active Directory Certificate Services</span></h2>
<p   
>    <span style="color: #000000;">
To configure Active Directory Certificate Services:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Click the new task shown in the Server Manager notifications: <strong class=" ">Configure Active Directory Certificate Services on the destination server</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
In the shown credentials panel, click <strong class=" ">Change</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Enter an account that belongs to the Domain/Enterprise Admin group, click <strong class=" ">OK,</strong> and then click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select role services to configure <strong class=" ">Certification Authority</strong> and <strong class=" ">Certification Authority Web Enrollment,</strong> and then click <strong class=" ">Next.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Enterprise CA,</strong> and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Root CA,</strong> and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Create a new private key </strong>and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Set the Cryptography provider to <strong class=" ">RSA#Microsoft Software Key Storage Provider</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Set the Key Length to <strong class=" ">4096</strong> bits.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Set the hash algorithm to <strong class=" ">SHA256</strong> and click <strong class=" ">Next</strong>.<strong class=" "><br/></strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Enter a     </span>
    <span style="color: #0e101a;">
unique     </span>
    <span style="color: #000000;">
name for the CA such as &lt;<strong class=" ">MSCA-Proxy</strong>&gt; and then click <strong class=" ">Next.</strong><br/>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Set the validity period <strong class=" ">25</strong> years.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Configure the location for the <strong class=" ">certificate database</strong> and <strong class=" ">certificate database</strong> logs.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Next,</strong> then click <strong class=" ">Configure,</strong> and then click <strong class=" ">Close.</strong>    </span>
</p>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDItQ29uZmlndXJlQWN0aXZlRGlyZWN0b3J5Q2VydGlmaWNhdGVFbnJvbGxtZW50UG9saWN5U2VydmljZXM">
        <h1 class="heading "><span>Step 2 - Configure Active Directory Certificate Enrollment Policy Services</span></h1>
<p   
>    <span style="color: #000000;">
To configure the Active Directory Certificate Enrollment Policy Services on the Certificate Services Server, first create and prepare the Service Account and then install the Certificate Enrollment Services according to the instructions below.    </span>
</p>
    <div class="section section-2" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtUHJlcGFyZVNlcnZpY2VBY2NvdW50">
        <h2 class="heading "><span>Prepare Service Account</span></h2>
<p   
>    <span style="color: #000000;">
To prepare the Service Account:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
If not done yet, create the service account (&lt;<strong class=" ">ces-service</strong>&gt;) for Certificate Enrollment Services and the service account (&lt;<strong class=" ">servlet-service</strong>&gt;) for the Tomcat servlet on AD Domain Services Server    </span>
<br/>    <span style="color: #000000;">
<img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Use the single service account if performing this installation with a single service account on a single host.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Open the Local Users and Group manager (<tt class=" ">lusrmgr.msc</tt>).    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Navigate to <strong class=" ">Groups</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Right-click the <strong class=" ">IIS_IUSRS</strong> group and select <strong class=" ">Properties</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Add </strong>and enter the object name &lt;<strong class=" ">YOURCOMPANY\ces-service</strong>&gt;.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">OK</strong> and enter an account that belongs to the Domain/Enterprise Admin group, then click <strong class=" ">OK</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Open the Command Prompt with Admin permissions.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Set the service principal name for the service account by running the following commands as admin and ensure to replace the server &lt;<strong class=" ">FQDN</strong>&gt; and account names with your own configuration.    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">setspn -s HTTP/csserver.yourcompany.com ces-service</code></div>
<div class="line"><code class="plain">setspn -s HTTP/tomcatserver.yourcompany.com servlet-service</code></div>
</div>
    </div>
<p   
>    <span style="color: #000000;">
<img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 If using a single service account and performing this installation on a single host (the csserver host), ensure to only run the <tt class=" ">setspn</tt> command once.    </span>
</p>
</li></ol>    </div>
    <div class="section section-2" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtSW5zdGFsbENlcnRpZmljYXRlRW5yb2xsbWVudFNlcnZpY2Vz">
        <h2 class="heading "><span>Install Certificate Enrollment Services</span></h2>
<p   
>    <span style="color: #000000;">
To install the Certificate Enrollment Services:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Open the Server Manager.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Add roles and features</strong> and click <strong class=" ">Next.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Role-based or feature-based installation</strong> and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Select a server from the server pool</strong>, select this server and click <strong class=" ">Next.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand the <strong class=" ">Active Directory Certificate Services</strong>, select <strong class=" ">Certificate Enrollment Web Service</strong> and <strong class=" ">Certificate Enrollment Policy Web Service</strong> and then click <strong class=" ">Next</strong>.<i class=" "><br/></i>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Proceed until the Confirmation page and click <strong class=" ">Install</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Reboot the server after the roles have been installed.    </span>
</p>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDMtQ29uZmlndXJlQ2VydGlmaWNhdGVUZW1wbGF0ZXM">
        <h1 class="heading "><span>Step 3 - Configure Certificate Templates</span></h1>
<p   
>    <span style="color: #000000;">
Follow the instructions in the following sections to configure Certificate Templates and Certificate Enrollment Services, and issue a Server Certificate to the CS server.    </span>
</p>
    <div class="section section-2" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtQ29uZmlndXJlQ2VydGlmaWNhdGVUZW1wbGF0ZXM">
        <h2 class="heading "><span>Configure Certificate Templates</span></h2>
<p   
>    <span style="color: #000000;">
To configure Certificate Templates:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Open the Certificate Authority Manager (<strong class=" ">certsrv.msc</strong>).    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand the selection for your CA.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Right-click <strong class=" ">Certificate Templates</strong> and click <strong class=" ">Manage.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Ignore the create the object identifier list warning and click <strong class=" ">OK</strong>, and then click <strong class=" ">Refresh</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Right-click the <strong class=" ">Computer</strong> template, select <strong class=" ">Duplicate Template</strong> and specify the following:<br/>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Under <strong class=" ">Compatibility Settings</strong>, specify Certification Authority=<strong class=" ">Windows Server 2003</strong> and Certificate recipient=<strong class=" ">Windows XP/Server 2003</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click the <strong class=" ">General</strong> tab, and change the Template display name to <strong class=" ">Computer_Auto_Enrollment</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click the <strong class=" ">Security</strong> tab, and give &quot;Domain Computers&quot; permissions to <strong class=" ">Enroll</strong> and <strong class=" ">Autoenroll</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select the <strong class=" ">Subject Name</strong> tab, and change the Subject name format to <strong class=" ">DNS Name</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">DNS Name</strong> in the subject alternative name.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Under the <strong class=" ">Request Handling</strong> tab, clear <strong class=" ">Allow private key to be exported</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">OK</strong> to go back to the template list.    </span>
</p>
</li></ol></li><li class=" "><p   
>    <span style="color: #000000;">
Right-click the <strong class=" ">User</strong> template and select <strong class=" ">Duplicate Template </strong>and specify the following:<br/>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Under <strong class=" ">Compatibility Settings</strong>, specify Certification Authority<strong class=" ">=Windows Server 2003</strong> and Certificate recipient=<strong class=" ">Windows XP/Server 2003</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click the <strong class=" ">General</strong> tab, and change the Template display name to <strong class=" ">User_Auto_Enrollment</strong>.    </span>
    <span style="color: #000000;">
<br/><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 If the requirement is to Publish the User certificate in Active Directory and Credential Roaming is enabled, ensure to s    </span>
    <span style="color: #000000;">
elect both <strong class=" ">Publish certificate in Active Directory </strong>and     </span>
    <span style="color: #000000;">
<strong class=" ">Do not automatically re-enroll if a duplicate certificate exists in Active Directory</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select the <strong class=" ">Security</strong> tab, and give &quot;Domain Users&quot; permissions to <strong class=" ">Enroll</strong> and <strong class=" ">Autoenroll</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select the <strong class=" ">Subject Name</strong> tab, and change the Subject name format to <strong class=" ">Common name</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Clear <strong class=" ">Include email name in subject name</strong> and     </span>
    <span style="color: #000000;">
clear <strong class=" ">Email name</strong> in the subject alternative name.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">User principal name (UPN)</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Under the <strong class=" ">Request Handling</strong> tab, clear <strong class=" ">Allow private key to be exported</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">OK</strong> to go back to the template list and then c    </span>
    <span style="color: #000000;">
lose the <strong class=" ">Certificate Templates Console</strong> window.    </span>
</p>
</li></ol></li><li class=" "><p   
>    <span style="color: #000000;">
Return to the Certificate Authority manager, r    </span>
    <span style="color: #000000;">
ight-click <strong class=" ">Certificate Templates</strong>, specify the following and then click<strong class=" "> OK</strong>:<strong class=" "><br/></strong>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">New</strong> &gt; <strong class=" ">Certificate Template to Issue</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Computer_Auto_Enrollment</strong> and <strong class=" ">User_Auto_Enrollment</strong>.    </span>
</p>
</li></ol></li><li class=" "><p   
>    <span style="color: #000000;">
Delete all templates in the Certificate Templates section except for the 2 templates <strong class=" ">Computer_Auto_Enrollment </strong>and <strong class=" ">User_Auto_Enrollment</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
To obtain the Microsoft certificate template OIDs:<br/>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Open Powershell and run the following command to get the Certificate Template OID:<br/>    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">Certutil -catemplates -v | select-string displayname,msPKI-Cert-Template-OID</code></div>
</div>
    </div>
</li><li class=" "><p   
>    <span style="color: #000000;">
Ensure to note the OIDs for the <strong class=" ">Computer_Auto_Enrollment</strong> and <strong class=" ">User_Auto_Enrollment</strong> templates since you will use these values late    </span>
r.</p>
</li></ol></li></ol>    </div>
    <div class="section section-2" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtQ29uZmlndXJlQ2VydGlmaWNhdGVFbnJvbGxtZW50U2VydmljZXM">
        <h2 class="heading "><span>Configure Certificate Enrollment Services</span></h2>
<p   
>    <span style="color: #000000;">
To configure Certificate Enrollment Services:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Click the new task shown in the Server Manager notifications: <strong class=" ">Configure Active Directory Certificate Services on the destination server</strong>.<strong class=" "><br/></strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
In the credentials panel shown, click <strong class=" ">Change</strong>.<strong class=" "><br/></strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Enter an account that belongs to the Domain/Enterprise Admin group, click <strong class=" ">OK</strong> and then click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Certificate Enrollment Web Service</strong> and <strong class=" ">Certificate Enrollment Policy Web Service</strong> and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select the <strong class=" ">CA Name</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Select</strong> and select the Microsoft CA that will be issuing the certificates using certificate enrollment web service, click <strong class=" ">OK</strong> and then click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
For CES authentication type, select <strong class=" ">Windows Integrated Authentication</strong> and then click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
For CES service account, select <strong class=" ">Specify service account</strong> and then click <strong class=" ">Select</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Specify the service account &lt;<strong class=" ">ces-service</strong>&gt; and credentials and ensure to use the single service account created if using a single service account.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">OK</strong> and then click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
For CEP authentication type, select <strong class=" ">Windows Integrated Authentication</strong> and then click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
For Certificate authentication, select <strong class=" ">Choose and assign a certificate for SSL later</strong> and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Review the confirmation page and click <strong class=" ">Configure</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
When the installation completes, click <strong class=" ">Close</strong>.    </span>
</p>
</li></ol>    </div>
    <div class="section section-2" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtSXNzdWVTZXJ2ZXJDZXJ0aWZpY2F0ZXRvQ1NTZXJ2ZXI">
        <h2 class="heading "><span>Issue Server Certificate to CS Server</span></h2>
<p   
>    <span style="color: #000000;">
To issue a Server Certificate to the CS server:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Open Microsoft Management Console <strong class=" ">(mmc.exe</strong>).    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Add the <strong class=" ">Certificates</strong> snap-in.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Choose <strong class=" ">Computer account</strong>, select <strong class=" ">Local Computer</strong> and then click<strong class=" "> OK</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Navigate to Certificate (Local Computer) and select <strong class=" ">Personal</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Right-click and select<strong class=" "> All Tasks &gt;</strong> <strong class=" ">Request New Certificate </strong>and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Active Directory Enrollment Policy </strong>and click <strong class=" ">Next</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Computer</strong> and <strong class=" ">Enroll</strong>, click <strong class=" ">Next</strong>, and then click <strong class=" ">Finish.</strong>    </span>
</p>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDQtQ29uZmlndXJlSUlT">
        <h1 class="heading "><span>Step 4 - Configure IIS</span></h1>
<p   
>    <span style="color: #000000;">
To configure the Internet Information Services (IIS), do the following:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Open the Internet Information Services (IIS) Manager (InetMgr.exe)    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click your server name on the left-hand side    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand the selection for your server and click <strong class=" ">Application Pools</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Right-click <strong class=" ">WSEnrollmentPolicyServer</strong>, and select <strong class=" ">Advanced Settings</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit <strong class=" ">Identity</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
In the appearing panel, select <strong class=" ">Custom account</strong> and click <strong class=" ">Set.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Enter the username and credentials for &lt;<strong class=" ">yourcompany</strong><strong class=" ">\ces-service</strong>&gt;. If using a single service account, ensure to use the single service account created.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">OK </strong>and expand <strong class=" ">Sites</strong> in the Connection menu on the left-hand side.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Default Web Site </strong>and then click <strong class=" ">Bindings</strong> on the right-hand side.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit the <strong class=" ">https</strong> site binding.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
From <strong class=" ">SSL certificate</strong>, select the CS Server's SSL certificate <strong class=" ">csserver.yourcompany.com</strong>, click <strong class=" ">OK </strong>and then click <strong class=" ">Close.</strong><strong class=" "><br/></strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand the <strong class=" ">Default Web Site</strong> option on the left-hand side.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">ADPolicyProvider_CEP_Kerberos </strong>and open <strong class=" ">Application Settings.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit the entry name <strong class=" ">FriendlyName</strong> and set the value to <strong class=" ">EJBCA_Enrollment</strong>. This is a name that clients will see only when manually requesting certificates.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">Add </strong>and create a new entry with the name <strong class=" ">RetryIntervalMs</strong> and value <strong class=" ">300000</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Restart IIS by clicking on the server name and then click <strong class=" ">Restart</strong> on the right-hand side.    </span>
</p>
</li></ol>    </div>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDUtQ29uZmlndXJlR3JvdXBQb2xpY2llc29uQURzZXJ2ZXI">
        <h1 class="heading "><span>Step 5 - Configure Group Policies on AD server</span></h1>
<p   
>    <span style="color: #000000;">
Configure Group Policies on the AD server according to the following:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Access Group Policy Management (gpmc.msc) on the AD Domain Services server.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand your domain forest =&gt; Domains =&gt; your domain name =&gt; and select <strong class=" ">Default Domain Policy</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Right-click <strong class=" ">Default Domain Policy</strong> and select <strong class=" ">Edit</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand <strong class=" ">Computer Configuration </strong>and select <strong class=" ">Policies &gt; Windows Settings &gt; Security Settings &gt; Public Key Policies</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit <strong class=" ">Certificate Services Client &ndash; Auto-Enrollment </strong>according to the following and then click <strong class=" ">OK</strong>.<strong class=" "><br/></strong>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Change Configuration Model to <strong class=" ">Enabled</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Update certificates that use certificate templates</strong>.    </span>
</p>
</li></ol></li><li class=" "><p   
>    <span style="color: #000000;">
Expand <strong class=" ">User Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Public Key Policies</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit <strong class=" ">Certificate Services Client &ndash; Auto-Enrollment</strong> according to the following and then click <strong class=" ">OK</strong>.<strong class=" "><br/></strong>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Change Configuration Model to <strong class=" ">Enabled</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Update certificates that use certificate templates</strong>.    </span>
</p>
</li></ol></li></ol><p   
>    <span style="color: #000000;">
<strong class=" ">Optional</strong>: If you require to Publish the User certificates in Active Directory and maintain the same User certificate across all domain-joined workstations, perform the following steps. If not, a user that logs on to multiple workstations will be issued a certificate for each workstation profile by design.    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Expand <strong class=" ">User Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Public Key Policies</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit <strong class=" ">Certificate Services Client &ndash; Credential Roaming</strong>:<strong class=" "><br/></strong>    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Click the <strong class=" ">General</strong> tab, change to <strong class=" ">Enabled</strong>, and click <strong class=" ">OK</strong>.<strong class=" "><br/></strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
In the message about Roaming Uses Profile exclusion list displayed, acknowledge and click <strong class=" ">OK</strong>.    </span>
</p>
</li></ol></li></ol>    </div>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDYtVGVzdE1pY3Jvc29mdEF1dG9FbnJvbGxtZW50">
        <h1 class="heading "><span>Step 6 - Test Microsoft Auto Enrollment</span></h1>
<p   
>    <span style="color: #000000;">
To test the Microsoft Auto Enrollment:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Add the Windows Client host member of the domain (<strong class=" ">yourcompany.com</strong>).    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Log in as user member of the <strong class=" ">Domain Admins</strong> group.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Open the Microsoft Management Console (mmc.exe).    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Click <strong class=" ">File&gt;Add/Remove Snap-in</strong> and select <strong class=" ">certificates</strong> for both <strong class=" ">user</strong> and <strong class=" ">local computer</strong>    </span>
    <span style="color: #0000ff;">
<i class=" ">    <span style="color: #000000;">
.    </span>
<br/></i>    </span>
<i class=" ">    <span style="color: #0000ff;">
<img  class="confluence-embedded-image"  src="images/download/attachments/85924705/worddav07cd6fda120371fe916140553727ca2a.png" alt="images/download/attachments/85924705/worddav07cd6fda120371fe916140553727ca2a.png" width="556" height="161" />
<br/>    </span>
</i></p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Verify that the user certificate was generated (Current User/ Personal/ Certificates).    </span>
<br/>    <span style="color: #000000;">
Ensure that the user certificate in the personal store is generated by the Windows CA using your duplicated template.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Verify that the computer certificate was generated. (Local Computer/ Personal/ Certificates requires Admin privileges to check the local computer certificate store).    </span>
<br/>    <span style="color: #000000;">
Ensure that the computer certificate in the personal store is generated by the Windows CA using your duplicated template.    </span>
</p>
</li></ol>    </div>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDctVXBkYXRlTVNBdXRvRW5yb2xsbWVudFNlcnZlclVSTA">
        <h1 class="heading "><span>Step 7 - Update MS Auto Enrollment Server URL</span></h1>
<p   
>    <span style="color: #000000;">
To update the MS Auto Enrollment Server URL:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Open a command prompt on the Certificate Services Server &lt;<strong class=" ">csserver</strong>&gt;<strong class=" ">.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Run the following command <u class=" ">as user</u> to get the current URL, and ensure to replace the server &lt;<strong class=" ">FQDN</strong>&gt; and &lt;<strong class=" ">MSCA</strong><strong class=" ">CN</strong>&gt; names with your own configuration:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">certutil -config csserver.yourcompany.com\MSCA-Proxy -enrollmentserverurl</code></div>
</div>
    </div>
<p   
></p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Run the following command <u class=" ">as user</u> to remove the existing enrollment server URL, and ensure to replace the server &lt;<strong class=" ">FQDN</strong>&gt; and &lt;<strong class=" ">Enrollment Server</strong> <strong class=" ">URL</strong>&gt;with your own configuration:<br/>    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">certutil -config csserver.yourcompany.com\MSCA-Proxy -enrollmentserverurl https:</code><code class="comments">//csserver.yourcompany.com/MSCA-Proxy_CES_Kerberos/service.svc/CES delete</code></div>
</div>
    </div>
<p   
></p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Run the following command <u class=" ">as user</u> to add the new enrollment server URL, and ensure to replace the     </span>
    <span style="color: #000000;">
server &lt;<strong class=" ">FQDN</strong>&gt; and &lt;<strong class=" ">Enrollment Server URL</strong>&gt; with your own configuration:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">certutil -config csserver.yourcompany.com\MSCA-Proxy -enrollmentserverurl https:</code><code class="comments">//tomcatserver.yourcompany.com:8443/autoenroll/MSEnrollmentServlet Kerberos</code></div>
</div>
    </div>
<p   
></p>
</li><li class=" "><p   
>    <span style="color: #000000;">
To confirm, run the first command again to show the new updated URL.    </span>
</p>
</li></ol>    </div>
    <div class="section section-1" id="src-85924705_safe-id-aWQtLlBhcnQyOk1TQ2VydGlmaWNhdGlvbkF1dGhvcml0eWFuZEdyb3VwUG9saWNpZXN2Ny40LjAtU3RlcDgtVXBkYXRlR3JvdXBQb2xpY3lmb3JDZXJ0aWZpY2F0ZUVucm9sbG1lbnQ">
        <h1 class="heading "><span>Step 8 - Update Group Policy for Certificate Enrollment</span></h1>
<p   
>T    <span style="color: #000000;">
o update the Group Policy for Certificate Enrollment, do the following:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #000000;">
Access Group Policy Management (gpmc.msc) on the AD Domain Services server.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand your domain forest &gt; Domains &gt; your domain name, and then select <strong class=" ">Default Domain Policy</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Right-click <strong class=" ">Default Domain Policy</strong> and select <strong class=" ">Edit</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand <strong class=" ">Computer Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Public Key Policies</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit <strong class=" ">Certificate Services Client &ndash; Certificate Enrollment Policy</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Change Configuration Model to <strong class=" ">Enabled.</strong>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Remove the <strong class=" ">Active Directory Enrollment Policy</strong> from the Certificate Enrollment policy list, and then click <strong class=" ">Add</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Enter the policy server URI: https://&lt;<strong class=" ">csserver.yourcompany.com</strong>&gt;/ADPolicyProvider_CEP_Kerberos/service.svc/CEP, click <strong class=" ">Validate Server</strong>, and then click <strong class=" ">Add</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Default,</strong> and then click <strong class=" ">Add</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Expand <strong class=" ">User Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Public Key Policies</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Edit <strong class=" ">Certificate Services Client &ndash; Certificate Enrollment Policy</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Change Configuration Model to <strong class=" ">Enabled</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Remove the <strong class=" ">Active Directory Enrollment Policy</strong> from the Certificate Enrollment policy list, and then click <strong class=" ">Add</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Enter the policy server URI https://&lt;<strong class=" ">csserver.yourcompany.com</strong>&gt;/ADPolicyProvider_CEP_Kerberos/service.svc/CEP, click <strong class=" ">Validate Server</strong> and then click <strong class=" ">Add</strong>.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #000000;">
Select <strong class=" ">Default</strong>, and then click <strong class=" ">OK</strong>.    </span>
</p>
</li></ol>    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Part_1__Active_Directory_Domain_Services.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Part 1: Active Directory Domain Services</span>
        </a>
                <a href="Part_3__EJBCA_Administration.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Part 3: EJBCA Administration</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
