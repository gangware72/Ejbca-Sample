<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Managing CAs - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=93592580"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations_Guide.html">EJBCA Operations Guide</a></li>
                                                                                     <li><a href="CA_Operations_Guide.html">CA Operations Guide</a></li>
                                                            </ul>
</div>            <h1 id="src-93592580"> <span>Managing CAs</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p  class="auto-cursor-target" 
>This Certificate Authority Operations section provides information on managing CAs and instructions on how to create, renew, revoke, and import and export Certificate Authorities (CAs).</p>
<p  class="auto-cursor-target" 
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-CreatingCAs">Creating CAs</a></p>
</li><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-RenewingCAsRenew_CAs">Renewing CAs</a></p>
</li><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-RevokingCAsRevoke_CAs">Revoking CAs</a></p>
</li><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-ExportingandImportingCAsExport_and_import_CAs">Exporting and Importing CAs</a></p>
</li><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-RemoveandRestoreaCASoftKeyStoreRemove_and_restore_CA_soft_keystore">Remove and Restore a CA Soft Key Store</a></p>
</li><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-RelatedContent">Related Content</a></p>
</li></ul>    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>For more conceptual information on CAs, see <a   href="Certificate_Authority_Overview.html">Certificate Authority Overview</a>.</p>
        </div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>This page primarily covers x509 CAs. For information about CVC CAs, see the <a   href="Managing_CVC_CAs.html">CVC Operations</a> page.</p>
        </div>
    </div>
    <div class="section section-1" id="src-93592580_id-.ManagingCAsv7.4.3-CreatingCAs">
        <h1 class="heading "><span>Creating CAs</span></h1>
<p   
>Once through your first installation, you'll have a default CA created on your instance of EJBCA called the<strong class=" "> Management CA</strong>. This CA is EJBCA's own bootstrap CA, and will be used by you internally from now on in order to issue end user certificates for your administrators.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.46.30.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.46.30.png" width="400"  />
    </p>
<p   
>From here on, you're free to create three types of CAs:</p>
<ul class=" "><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-RootCAs">Root CAs</a></p>
</li><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-SubCAs">Sub CAs</a></p>
</li><li class=" "><p   
><a   href="#src-93592580_id-.ManagingCAsv7.4.3-ExternalCAs">External CAs</a></p>
</li></ul>    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-RootCAs">
        <h2 class="heading "><span>Root CAs</span></h2>
<p   
>To add a root CA, fill in the desired name at <strong class=" ">Add CA</strong> and click <strong class=" ">Create</strong>.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.48.56.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.48.56.png" width="600"  />
    </p>
<p   
>This will move you on to the edit CA screen. The important things to pick here is the signer of the CA's certificate, and picking the correct <a   href="Certificate_Profiles_Overview.html">Certificate Profile</a>.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.49.12.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.49.12.png" width="600"  />
    </p>
<p   
><strong class=" ">Self Signed </strong>means that this CA has signed itself, i.e. making it a root. The certificate profile can either be the <strong class=" ">ROOTCA</strong> template, or a derivative of it. Fill in any other desired values, then click <strong class=" ">Create</strong> at the bottom of the screen.</p>
    <div class="section section-3" id="src-93592580_safe-id-aWQtLk1hbmFnaW5nQ0FzdjcuNC4zLUNyZWF0aW5nYVJvb3RDQXRocm91Z2h0aGVDb21tYW5kTGluZUludGVyZmFjZShDTEkp">
        <h3 class="heading "><span>Creating a Root CA through the Command Line Interface (CLI)</span></h3>
<p   
>You can create CAs using the following CLI command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca init</code></div>
</div>
    </div>
<p   
>Issuing the command with the flag <strong class=" ">--help</strong> will print a full list of all flags and options. A typical example of using this command is as follows:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca init TestRoot </code><code class="string">"C=SE,O=PrimeKey,CN=TestRoot"</code><code class="plain"> soft foo123 2048 RSA 365 --policy 2.5.29.32.0 SHA256WithRSA</code></div>
</div>
    </div>
<p   
>This will create a root CA with the DN <strong class=" ">C=SE,O=PrimeKey,CN=TestRoot</strong>. The key length is 2048 bit (RSA) and the validity of the root certificate is 365 days. You need to quote the DN so it is treated as one argument. PKIX requires that a CRL always is available even if it is empty. When creating a new CA the CA certificate is stored and published (if any Publishers are configured), and the initial CRL is created and stored/published.</p>
    </div>
    </div>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-ExternalCAs">
        <h2 class="heading "><span>External CAs</span></h2>
<p   
>For some uses such as replying to <a   href="OCSP.html">OCSP queries</a>, you may want to import a CA certificate from a CA which exists on another instance of EJBCA, or from another CA distribution entirely. To do so, click <strong class=" ">Import CA Certificate.</strong></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.07.43.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.07.43.png" width="600"  />
    </p>
<p   
>You'll then be asked to first name the externally imported CA and then upload the certificate belonging to that CA.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.08.05.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.08.05.png" width="600"  />
    </p>
<p   
>Clicking <strong class=" ">Import CA Certificate </strong>will create a proxy for this CA locally.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.08.20.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.08.20.png" width="400"  />
    </p>
<p   
>This CA will naturally not be editable, and the only available actions are setting up some OCSP functionality and the ability to update the certificate should a new one be issued.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.08.35.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.08.35.png" width="600"  />
    </p>
    </div>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-SubCAs">
        <h2 class="heading "><span>Sub CAs</span></h2>
<p   
>A sub CA (or <i class=" ">intermediate CA</i>) is a CA which is signed by another CA. To create a sub CA, specify a name the <strong class=" ">Add CA</strong> field and click <strong class=" ">Create</strong>.</p>
    <div class="section section-3" id="src-93592580_id-.ManagingCAsv7.4.3-CreatingaSubCAsignedbyalocalCA">
        <h3 class="heading "><span>Creating a Sub CA signed by a local CA</span></h3>
<p   
>If the signer of the Sub CA exists locally on the same instance, pick that CA as <strong class=" ">Signed By</strong>:</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.59.06.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_11.59.06.png" width="600"  />
    </p>
<p   
>The certificate profile should either be the <strong class=" ">SUBCA </strong>template or a derivative of it.</p>
    </div>
    <div class="section section-3" id="src-93592580_id-.ManagingCAsv7.4.3-CreatingaSubCASignedbyanExternalCA">
        <h3 class="heading "><span>Creating a Sub CA Signed by an External CA</span></h3>
<p   
>Alternatively, it may be desirable (and not uncommon) to have the CA be signed by an <strong class=" ">External CA</strong>, as defined above. Going through the same steps during the creation process, when picking <strong class=" ">Signed </strong><strong class=" ">By</strong>, choose on the predefined value <strong class=" ">External CA.</strong></p>
<p   
><strong class=" "><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.16.30.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.16.30.png" width="600"  />
</strong></p>
<p   
>Notice that the Certificate Profile isn't choosable, as this will be decided by the issuing CA. Likewise, the fields <strong class=" ">Validity</strong>,<strong class=" "> Subject Alternative Name</strong> and <strong class=" ">Policy Id</strong> will also be defined by the issuing CA.</p>
<p   
>Going to the bottom of the screen, click <strong class=" ">Make Certificate Request</strong>.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.38.37.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.38.37.png" width="600"  />
    </p>
<p   
>This will bring you to a Certificate Signing Request (CSR) which you can either copy down to a file or download as either a PEM or a binary DER file, which you can then bring to your issuing CA to be signed.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.23.26.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.23.26.png" width="600"  />
    </p>
<p   
>This creates the Sub CA in a waiting state.</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.40.49.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.40.49.png" width="400"  />
    </p>
<p   
>Once the CSR has been signed and a certificate received, click <strong class=" ">Edit CA</strong> and scroll down to the section named <strong class=" ">Externally signed CA creation/renewal</strong>. From here you can either create a new CSR (for future renewals) or upload the signed certificate from the issuing CA:</p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.43.57.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_12.43.57.png" width="600"  />
    </p>
<p   
>Click <strong class=" ">Receive Certificate Response</strong>, and you should be good to go.</p>
    </div>
    <div class="section section-3" id="src-93592580_id-.ManagingCAsv7.4.3-CreatingaCASignedbyanExternalCAUsingtheCLI">
        <h3 class="heading "><span>Creating a CA Signed by an External CA Using the CLI</span></h3>
<p   
>Create the CA generating a CSR. Note that the Crypto token password is set to <tt class=" ">foo123</tt>:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca init CaSignedByExteral </code><code class="string">"CN=This CA is Signed by an external CA"</code><code class="plain"> soft foo123 secp256r1 ECDSA 365 null SHA256withECDSA --signedby External -externalcachain chain.pem</code></div>
</div>
    </div>
<p   
>The file <strong class=" ">chain.pem </strong>contains the certificate chain of the external CA, as described above. Running the above command, a CSR named <strong class=" ">CaSignedByExteral_csr.der</strong> is saved to your disk, containing a PKCS#10 CSR in binary format. Send the CSR to the external CA and get the signed sub CA certificate returned back.</p>
<p   
>Import the sub CA certificate, activating your CA:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca importcacert CaSignedByExteral subcacertificate.pem</code></div>
</div>
    </div>
<p   
>The file <strong class=" ">subcacertificate.pem</strong> contains the received sub CA certificate.</p>
    </div>
    </div>
    <div class="section section-2" id="src-93592580_safe-id-aWQtLk1hbmFnaW5nQ0FzdjcuNC4zLUNyZWF0aW5nYUNBdGhyb3VnaEVKQkNBJ3NXZWJTZXJ2aWNlQVBJ">
        <h2 class="heading "><span>Creating a CA through EJBCA's WebService API</span></h2>
<p   
></p>
<p   
><span class="status blue " >ENTERPRISE</span>
 This is an EJBCA Enterprise feature.</p>
<p   
>If EJBCA's web service is set up, it is also possible to create new CA by using the WS API call <a  class="external-link" href="https://www.ejbca.org/docs/ws/org/ejbca/core/protocol/ws/client/gen/EjbcaWS.html#createCA(java.lang.String,%20java.lang.String,%20java.lang.String,%20long,%20java.lang.String,%20java.lang.String,%20int,%20java.lang.String,%20java.util.List,%20java.util.List)">createCA</a> in your application or with the <a   href="Web_Service_Interface.html#src-53346305_id-.WebServiceInterfacev7.1.0-Using_the_Web_Services_CLI">Web Services CLI</a>.</p>
    </div>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-RequestingaCrossorBridgeCertificate">
        <h2 class="heading "><span>Requesting a Cross or Bridge Certificate</span></h2>
<p   
>If you have set up your own CA you can request another CA to cross certify your CA, or you can get certified by Bridge CA such as the Federal Bridge.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Handling the certificate chains on clients is out of the scope for EJBCA.</p>
        </div>
    </div>
<p   
>This is done in the following way:</p>
<ol class=" "><li class=" "><p   
>In the <strong class=" ">Edit CA </strong>page, choose a CA that you intend to get cross certified by another CA and click <strong class=" ">Edit</strong>.</p>
</li><li class=" "><p   
>In the lower part of the screen, click on <strong class=" ">Make Certificate Request</strong> and skip upload of the signing certificate chain.</p>
</li><li class=" "><p   
>Save the created PKCS#10 certificate request to disk and send to the other CA.</p>
</li></ol><p   
>Now you have a certificate request to send to the other CA or Bridge CA. When the other CA has issued a certificate for you, everything is completed. You don't need to (and usually should not) import the cross-certificate or bridge-certificate in EJBCA. What you need to do is make sure the clients using the certificates issued by your CA have access to the correct certificate chain. If you are cross-certified with several other CA, multiple possible certificate chains exist.</p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>If you choose to upload the resulting certificate chain, this will convert your CA from an internal CA to an externally signed CA.</p>
        </div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-93592580_id-.ManagingCAsv7.4.3-RenewingCAsRenew_CAs">
        <h1 class="heading "><span id="src-93592580_id-.ManagingCAsv7.4.3-Renew_CAs" class="confluence-anchor-link"></span><span>Renewing CAs </span></h1>
<p   
>When a CA expires you have the choice of renewing the existing CA, or creating a new CA. Note that our general recommendation is to create a new CA subject DN when renewing Root CAs, see <a   href="CA_Rekey_Recommendations.html">CA Rekey Recommendations</a>. The following describes renewing a CA certificate keeping the same subject DN.</p>
<p   
>You can renew CAs in different ways:</p>
<ul class=" "><li class=" "><p   
>Renew only CA certificate, using the same keys.</p>
</li><li class=" "><p   
>Renew CA keys and certificate.</p>
</li></ul><p   
>To renew only the CA certificate using the same keys, click <strong class=" ">Renew CA</strong>. Note that your CA must be online to be able to sign the new certificate (if a self-signed CA), or the certificate request (if a sub CA). Additionally, if using a sub CA with the root CA in the same EJBCA instance, the root CA is also required to be online.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>When renewing the CA certificate without renewing keys, the same signing key is used as before, and the subject key ID in the CA certificate will stay the same. This option is useful if something in the CA certificate needs to be fixed. To limit the time a Root CA key is used it is considered best practice to do a CA rollover with renewing CA signature keys.</p>
        </div>
    </div>
<p   
></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_10.08.02.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_10.08.02.png" width="600"  />
    </p>
<p   
>To renew the CA keys, set <strong class=" ">Next CA key</strong> to <strong class=" ">Generate new key using KeySequence </strong>and click <strong class=" ">Renew CA</strong>. Note that not all HSMs support renewal of CA keys.</p>
<p   
>When using an HSM, manual renewal of keys can also be made by generating new keys on the HSM, using for example the EJBCA CLI tools, and then selecting the generated keys in the <strong class=" ">Next CA key</strong> field and clicking <strong class=" ">Renew CA</strong>.</p>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-UsingCARollover">
        <h2 class="heading "><span>Using CA Rollover</span></h2>
<p   
><span id="src-93592580_id-.ManagingCAsv7.4.3-ca_rollover"></span></p>
<p   
>It is possible to renew a CA certificate, but not activate the new certificate and key immediately. This is useful for CA certificates that will become valid at some point in the future (in EJBCA, such certificates can be created by checking &quot;Allow Validity Override&quot; in the certificate profile). A such certificate is called a <i class=" ">rollover certificate</i> or a <i class=" ">next CA certificate</i>, and can be used in the <a   href="SCEP.html">SCEP protocol.</a></p>
<p   
><img  class="confluence-embedded-image"  src="images/download/attachments/93592580/Screenshot_2020-04-15_at_10.09.09.png" alt="images/download/attachments/93592580/Screenshot_2020-04-15_at_10.09.09.png" width="600"  />
    </p>
<p   
>First, make a certificate request as usual. Then you may receive the CA certificate response without activating it. To do so, edit the CA and check the &quot;Rollover certificate (activated later)&quot; checkbox. Then select the new CA certificate file its corresponding key. Then click &quot;Receive Certificate Response&quot;. A message will appear, which shows when the rollover certificate becomes valid, and may be activated.</p>
<p   
>At a later point, the new rollover certificate may be activated. To activate it, edit the CA and scroll down to &quot;CA Life Cycle&quot;. There should be text telling when the current certificate expires and when the rollover certificate becomes valid. If not, the CA doesn't have any rollover certificate. Click the button &quot;Perform CA Rollover&quot;, and the new rollover certificate will be activated.</p>
<p   
>There is also a service, <i class=" ">Rollover Service</i>, that can be configured to activate rollover certificates automatically once they become valid. There will be a 10 minute delay in this case to allow for a small amount of clock skew.</p>
    <div class="section section-3" id="src-93592580_id-.ManagingCAsv7.4.3-SigningaRolloverCertificatea.k.aLinkCertificate">
        <h3 class="heading "><span>Signing a Rollover Certificate a.k.a Link Certificate</span></h3>
<p   
>One way to handle update of trust points when renewing a Root CA is to generate a certificate that contains the new key signed with the old key. For X.509 CAs, you can create such a certificate by selecting <strong class=" ">Create link certificate</strong> before renewing the CA. The latest link certificate can then be downloaded from the <strong class=" ">Edit CA</strong> view. For CVC CAs a link certificate is always generated during the renewal.</p>
<p   
>ICAO and some other PKI have stated requirements to create link certificates, new-with-old, in order to distribute new Root CA certificates without the need for an out of band secure channel (i.e. clients can verify the new Root certificate with their existing trust anchor). Some RFCs (for example, <a  class="external-link" href="https://www.ietf.org/rfc/rfc4210.txt">RFC4210</a>) also specifies an old-with-new link certificate. Although we do not see much practical use of this type of link certificate, it is possible to create such an old-with-new link manually according to the following instructions.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Do not perform the following steps unless you are sure that an old-with-new link certificate is required.</p>
        </div>
    </div>
<p   
>If you need to create an old-with-new link certificate, perform the following steps:</p>
<ol class=" "><li class=" "><p   
>Before starting the renewal, create a CSR from the Root CA.</p>
</li><li class=" "><p   
>Once the renewal is completed, sign the CSR with the new Root CA.</p>
<ul class=" "><li class=" "><p   
>Ensure that the CA has the options <strong class=" ">Enforce unique DN</strong> and <strong class=" ">Enforce unique public keys</strong> disabled during this operation.</p>
</li><li class=" "><p   
>Create a suitable SubCA certificate profile for the OldWithNew link certificate. Use the option <strong class=" ">Allow Subject DN Override by CSR</strong> and configure all attributes desired.</p>
</li><li class=" "><p   
>Create an end entity profile for the OldWithNew with the proper subject DN naming fields.</p>
</li><li class=" "><p   
>Issue the certificate, using the CSR from the old CA keys, signing the certificate with the new CA keys.</p>
</li><li class=" "><p   
>Verify the contents of the certificate carefully and that the correct links verify as they should.</p>
</li></ul></li></ol>    </div>
    </div>
    </div>
    <div class="section section-1" id="src-93592580_id-.ManagingCAsv7.4.3-RevokingCAsRevoke_CAs">
        <h1 class="heading "><span id="src-93592580_id-.ManagingCAsv7.4.3-Revoke_CAs" class="confluence-anchor-link"></span><span>Revoking CAs </span></h1>
<p   
>When revoking a sub CA, you can choose to only revoke the sub CA certificate or to revoke the sub CA certificate and all certificates issued by the sub CA. A TLS client would normally check the revocation status of each certificate in the certificate chain, in which case revoking only the sub CA certificate would be sufficient.</p>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-RevokingaCACertificate">
        <h2 class="heading "><span>Revoking a CA Certificate</span></h2>
<p   
>You revoke a sub CA certificate the same way as you revoke any other certificate in EJBCA. To revoke a sub CA certificate, do the following on the EJBCA instance where the issuer of the sub CA (normally a root CA) resides:</p>
<ol class=" "><li class=" "><p   
>Go to the RA Web and select <strong class=" ">Search &rarr; Certificates</strong>.</p>
</li><li class=" "><p   
>Search for the certificate by entering the common name of the sub CA, and click <strong class=" ">View</strong> to view the sub CA certificate.</p>
</li><li class=" "><p   
>Choose a revocation reason in the certificate status list menu and click <strong class=" ">Revoke</strong> to revoke the sub CA certificate.</p>
</li><li class=" "><p   
>Go the CA UI and click <strong class=" ">CA Structure and CRLs</strong>.</p>
</li><li class=" "><p   
>Click <strong class=" ">Create CRL</strong> on the appropriate issuer (root CA) to create a new CRL.</p>
</li><li class=" "><p   
>Optionally, download and distribute the new CRL to VA instances manually if this is not done automatically with a publisher.</p>
</li></ol>    </div>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-RevokingAllCertificatesIssuedbyaCA">
        <h2 class="heading "><span>Revoking All Certificates Issued by a CA</span></h2>
<p   
>You can also revoke all certificates issued by the sub CA. To revoke all certificates issued by the sub CA, do the following on the EJBCA instance where the sub CA resides:</p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>This operation may potentially create a very large CRL if the sub CA has issued a great number of certificates.</p>
        </div>
    </div>
<ol class=" "><li class=" "><p   
>Go to the CA UI and click <strong class=" ">Certification Authorities</strong>.</p>
</li><li class=" "><p   
>Select the sub CA whose certificates you want to revoke, and click <strong class=" ">Edit CA</strong> to edit the sub CA.</p>
</li><li class=" "><p   
>In the <strong class=" ">CA Life Cycle</strong> section, choose a revocation reason and click <strong class=" ">Revoke</strong> to revoke all certificates issued by the sub CA that are not yet revoked. This will also create a new CRL.</p>
</li></ol><p   
>If the CA is connected to a VA using peers, the VA will not automatically get the new status of the revoked certificates and you therefore need to synchronize manually as follows:</p>
<ol class=" "><li class=" "><p   
>Click <strong class=" ">Peer Systems</strong> in the menu.</p>
</li><li class=" "><p   
>Click <strong class=" ">Manage</strong> on the appropriate peer connector.</p>
</li><li class=" "><p   
>In the <strong class=" ">Certificate Data Synchronization</strong> tab, choose <strong class=" ">Only sync revoked</strong> and then click <strong class=" ">Start</strong> to push the status of the revoked certificates to the VA.</p>
</li></ol>    </div>
    </div>
    <div class="section section-1" id="src-93592580_id-.ManagingCAsv7.4.3-ExportingandImportingCAsExport_and_import_CAs">
        <h1 class="heading "><span id="src-93592580_id-.ManagingCAsv7.4.3-Export_and_import_CAs" class="confluence-anchor-link"></span><span>Exporting and Importing CAs </span></h1>
<p   
>Under certain circumstances, it can be wise to back up the CA's signature and encryption keys. Remember to protect the backup in the same way as the CA itself.</p>
<ul class=" "><li class=" "><p   
>Soft token CAs can be exported and backed up. CAs with the keys on an HSM cannot be exported through EJBCA. Use the HSMs methods to back up such keys.</p>
</li><li class=" "><p   
>Soft token CAs can be imported using both the CLI and Admin GUI, while HSM CAs can only be imported using the CLI.</p>
</li></ul><p   
>The aliases of the keys in exported key stores are important when importing the key stores, and allow you to assign the correct keys. To list the aliases (or friendlyName in OpenSSL terminology) in a PKCS#12 file, use the following OpenSSL command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ openssl pkcs12 -</code><code class="keyword">in</code><code class="plain"> </code><code class="plain">/home/user/tmp/kesytore</code><code class="plain">.p12</code></div>
</div>
    </div>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-UsingtheCAUIUsing_admin-GUI">
        <h2 class="heading "><span id="src-93592580_id-.ManagingCAsv7.4.3-Using_admin-GUI" class="confluence-anchor-link"></span><span>Using the CA UI </span></h2>
<p   
>To export and import the CA's keys using the CA GU, you need super administrator access. Make sure that .p12 files are not automatically saved to an unsuitable place by your browser before you perform an export.</p>
<p   
>To export the CA's keys, do the following:</p>
<ol class=" "><li class=" "><p   
>Select the <strong class=" ">Certificate Authorities</strong> menu option.</p>
</li><li class=" "><p   
>Select the CA to export and click <strong class=" ">Edit</strong>.</p>
</li><li class=" "><p   
>Next to <strong class=" ">CA export requires the keystore password</strong>, enter the keystore password.</p>
</li><li class=" "><p   
>Click <strong class=" ">Export CA keystore</strong>.</p>
</li><li class=" "><p   
>The PKCS#12-file will be downloaded by your browser to the location you specify.</p>
</li></ol><p   
>To import the CA's keys, do the following:</p>
<ol class=" "><li class=" "><p   
>Select the <strong class=" ">Certificate Authorities</strong> menu option.</p>
</li><li class=" "><p   
>Click <strong class=" ">Import CA keystore</strong>.</p>
</li><li class=" "><p   
>Specify the CA's name, full pathname to the PKCS#12-file, and keystore password.</p>
</li><li class=" "><p   
>If you exported the CA's keys using EJBCA, do not edit the two <strong class=" ">Alias</strong> field default values.</p>
</li><li class=" "><p   
>Click <strong class=" ">Import CA keystore</strong>.</p>
</li></ol>    </div>
    <div class="section section-2" id="src-93592580_id-.ManagingCAsv7.4.3-UsingCommandLineInterfaceUsing_command_line_interface">
        <h2 class="heading "><span id="src-93592580_id-.ManagingCAsv7.4.3-Using_command_line_interface" class="confluence-anchor-link"></span><span>Using Command Line Interface</span></h2>
<p   
>To export a CA named <strong class=" ">TestCA</strong> to the PKCS#12-file <strong class=" ">/path/TestCA.p12</strong> with password <strong class=" ">foo123</strong>, enter the following from the $EJBCA_HOME directory:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca exportca TestCA .</code><code class="plain">/TestCA</code><code class="plain">.p12</code></div>
<div class="line"><code class="plain">Using JBoss JNDI provider...</code></div>
<div class="line"><code class="plain">Enter keystore password: foo123</code></div>
<div class="line"><code class="plain">$</code></div>
</div>
    </div>
<p   
>To import the backup keys for <strong class=" ">TestCA</strong> later, enter the following from the $EJBCA_HOME directory:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca importca TestCA </code><code class="plain">/path/TestCA</code><code class="plain">.p12 SignatureKeyAlias EncryptionKeyAlias</code></div>
<div class="line"><code class="plain">Using JBoss JNDI provider...</code></div>
<div class="line"><code class="plain">Enter keystore password: foo123</code></div>
<div class="line"><code class="plain">$</code></div>
</div>
    </div>
<p   
>To view usage instructions on how to import HSM CAs, run the following command:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin</code><code class="plain">/ejbca</code><code class="plain">.sh ca importca --help</code></div>
</div>
    </div>
<p   
>If you import multiple CAs that are using the same HSM, and the same slot on the HSM, duplicate crypto tokens are created in EJBCA. Although there should only be one crypto token per slot, one crypto token per CA is created during the import of the CAs. To merge these crypto tokens after the import is complete, use the CLI command mergecatokens:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin/ejbca.sh ca mergecatokens --help</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-93592580_id-.ManagingCAsv7.4.3-RemoveandRestoreaCASoftKeyStoreRemove_and_restore_CA_soft_keystore">
        <h1 class="heading "><span id="src-93592580_id-.ManagingCAsv7.4.3-Remove_and_restore_CA_soft_keystore" class="confluence-anchor-link"></span><span>Remove and Restore a CA Soft Key Store </span></h1>
<p   
>Soft token CAs can have their keystore removed from the database. When the keystore is removed, the CA cannot issue certificates and its CA token status is set to <strong class=" ">offline</strong>.</p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Before removing the keystore, export it first to allow restoring it later, see <a   href="#src-93592580_id-.ManagingCAsv7.4.3-ExportandImportCAs">Export and Import CAs</a> above.</p>
        </div>
    </div>
<p   
>To remove the catoken keys for <strong class=" ">TestCA</strong>, enter the following from the $EJBCA_HOME directory:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin/ejbca.sh ca removekeystore TestCA</code></div>
<div class="line"><code class="plain">Using JBoss JNDI provider...</code></div>
<div class="line"><code class="plain">$ </code></div>
</div>
    </div>
<p   
>To restore the catoken keys again for <strong class=" ">TestCA</strong> with the keystore exported as <strong class=" ">TestCA-exported.p12</strong>, enter the following from the $EJBCA_HOME directory:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ bin/ejbca.sh ca restorekeystore TestCA /path/TestCA-exported.p12 -s SignatureKeyAlias -e EncryptionKeyAlias</code></div>
<div class="line"><code class="plain">Using JBoss JNDI provider...</code></div>
<div class="line"><code class="plain">Enter keystore password: foo123</code></div>
<div class="line"><code class="plain">$</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-93592580_id-.ManagingCAsv7.4.3-RelatedContent">
        <h1 class="heading "><span>Related Content</span></h1>
<ul class="childpages-macro "><li class=" "><p   
><a   href="Signing_an_External_CA.html">Signing an External CA</a></p>
</li><li class=" "><p   
><a   href="CA_Rekey_Recommendations.html">CA Rekey Recommendations</a></p>
</li></ul>    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Key_Recovery.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Key Recovery</span>
        </a>
                <a href="Signing_an_External_CA.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Signing an External CA</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
