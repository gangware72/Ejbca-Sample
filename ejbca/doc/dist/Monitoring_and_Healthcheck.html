<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Monitoring and Healthcheck - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=100270512"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations.html">EJBCA Operations</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Operations_Guide.html">EJBCA Operations Guide</a></li>
                                                                                                         <li class="shortcut"><a href="CA_Operations_Guide.html">CA Operations Guide</a></li>
                                                                                     <li><a href="EJBCA_Maintenance.html">EJBCA Maintenance</a></li>
                                                            </ul>
</div>            <h1 id="src-100270512"> <span>Monitoring and Healthcheck</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>EJBCA contains a health check service that can be used for health monitoring remotely. This should be considered essential if running EJBCA in a clustered installation, as it can be used to determine whether a node is able to remain in the cluster or needs to be taken out.</p>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-100270512_id-.MonitoringandHealthcheckv7.4.3-ServletURL">Servlet URL</a></p>
</li><li class=" "><p   
><a   href="#src-100270512_id-.MonitoringandHealthcheckv7.4.3-Configuration">Configuration</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-100270512_id-.MonitoringandHealthcheckv7.4.3-GeneralConfiguration">General Configuration</a></p>
</li><li class=" "><p   
><a   href="#src-100270512_id-.MonitoringandHealthcheckv7.4.3-MaintenanceFileProperties">Maintenance File Properties</a></p>
</li><li class=" "><p   
><a   href="#src-100270512_id-.MonitoringandHealthcheckv7.4.3-ServletConfiguration">Servlet Configuration</a></p>
</li></ul></li><li class=" "><p   
><a   href="#src-100270512_id-.MonitoringandHealthcheckv7.4.3-ErrorMessages">Error Messages</a></p>
</li><li class=" "><p   
><a   href="#src-100270512_id-.MonitoringandHealthcheckv7.4.3-RelatedContent">Related Content</a></p>
</li></ul>    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Note that it is up to the client and not the server to terminate the connection once the response has been sent, as that it is not possible to do so from within the application server. Failing to terminate the connection will lead to all available ports in the application server being used up and EJBCA eventually freezing.</p>
        </div>
    </div>
    <div class="section section-1" id="src-100270512_id-.MonitoringandHealthcheckv7.4.3-ServletURL">
        <h1 class="heading "><span>Servlet URL</span></h1>
<p   
>The servlet is located in the URL: <tt class=" ">http://localhost:8080/ejbca/publicweb/healthcheck/ejbcahealth</tt>.</p>
    </div>
    <div class="section section-1" id="src-100270512_id-.MonitoringandHealthcheckv7.4.3-Configuration">
        <h1 class="heading "><span>Configuration</span></h1>
<p   
>Which CAs that are checked by the health check service can be configured in the Admin Web on the CA Activation page as well as in the Edit CA page.</p>
    <div  class="confbox admonition admonition-info">
                    <p class="title">Common Criteria Compliance</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>To be fully Common Criteria compliant, a different key for signature tests than certificate signing should be used in the CA's HSM token configuration (the &quot;testKey&quot; alias should point to a key with no other uses).</p>
        </div>
    </div>
<p   
>The behavior of the servlet can be modified by configuring the below values in <tt class=" ">conf/ejbca.properties</tt>.</p>
    <div class="section section-2" id="src-100270512_id-.MonitoringandHealthcheckv7.4.3-GeneralConfiguration">
        <h2 class="heading "><span>General Configuration</span></h2>
<p   
>The following configuration parameters may be set to configure authorization and what the service checks:</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Key</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Default</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.amountfreemem</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>1</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The amount of memory that must be free on the server, in megabytes.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.dbquery</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>select 1</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Parameter indicating the string that should be used to do a minimal check that the database is working.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.authorizedips</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>127.0.0.1</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Specifies which remote IPs that may call this healthcheck servlet. Multiple IPs may be separated by a semicolon.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.catokensigntest</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>false</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Set to true to perform a test signature on each CA token during the check. Otherwise just checks that the token status is active.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.publisherconnections</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>false</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Set to true to perform a health test on all active publisher connections.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-2" id="src-100270512_id-.MonitoringandHealthcheckv7.4.3-MaintenanceFileProperties">
        <h2 class="heading "><span>Maintenance File Properties</span></h2>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Key</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Default</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.maintenancefile</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Location of file containing information about maintenance.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.maintenancepropertyname</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>DOWN_FOR_MAINTENANCE</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The key of the property value in the maintenance, should be in the following format: <tt class=" ">DOWN_FOR_MAINTENANCE=true</tt>.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-2" id="src-100270512_id-.MonitoringandHealthcheckv7.4.3-ServletConfiguration">
        <h2 class="heading "><span>Servlet Configuration</span></h2>
<p   
>The following parameters configure what message or HTTP error code the health service returns.</p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Key</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Default</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.okmessage</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>ALLOK</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Text string used to say that everything is ok with this node. Any properties defined properties value can be used here by inserting it in as a property, e.g:<br/><tt class=" ">ALLOK ${httpsserver.hostname} Version ${app.version.number}</tt></p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.sendservererror</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>true</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Set to true of the HTTP error code 500 should be sent in case of error.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>healthcheck.customerrormessage</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>null</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Allows for a custom error message to be configured.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    </div>
    <div class="section section-1" id="src-100270512_id-.MonitoringandHealthcheckv7.4.3-ErrorMessages">
        <h1 class="heading "><span>Error Messages</span></h1>
<p   
>If an error is detected one or several of the following error messages is reported. All errors will be sent with a response code of <strong class=" ">500</strong></p>
    <div  class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col />
                                    <col />
                            </colgroup>
        <thead class=" ">    <tr>
            <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Error</p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
    <p   
>Description</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>MEM: Error Virtual Memory is about to run out, currently free memory : <strong class=" ">number</strong></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>The JVM is about to run out of memory</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>DB: Error creating connection to database</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>JDBC Connection to the database failed, this might occur if DB crashes or network is down.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>CA: Error CA Token is disconnected: <strong class=" ">CAName</strong></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>This is a sign of hardware problems with one or several of the hard ca tokens in the node.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>MAINT: DOWN_FOR_MAINTENANCE</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>This is reported when the healthcheck.maintenancefile is used and the node is set to be offline.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Error when testing the connection with publisher: <strong class=" ">PublisherName</strong></p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>This is reported when a test connection to one of the publishers failed.</p>
            </td>
        </tr>
    <tr>
            <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Could not perform a test signature on the audit log.</p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
    <p   
>Reported when the audit log failed to sign (if database protection is enabled)</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-1" id="src-100270512_id-.MonitoringandHealthcheckv7.4.3-RelatedContent">
        <h1 class="heading "><span>Related Content</span></h1>
<ul class=" "><li class=" "><p   
><a   href="Monitoring_of_VAs.html">Monitoring of VAs</a></p>
</li></ul>    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="Clearing_System_Caches.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Clearing System Caches</span>
        </a>
                <a href="Monitoring_of_VAs.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Monitoring of VAs</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
