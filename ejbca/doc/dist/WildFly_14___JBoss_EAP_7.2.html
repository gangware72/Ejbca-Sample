<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>WildFly 14 / JBoss EAP 7.2 - EJBCA - Documentation Space</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>


<script type="text/javascript" src="assets/js/scroll-tree.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="108530570">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">EJBCADS</span>
                    <img class="space-logo" src="EJBCADS.png" />
                </h1>
                <a href="EJBCA_7.4.3.2_Documentation.html" class="ht-space-link">
                    <h2>EJBCA - Documentation Space</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=85197107"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="EJBCA_7.4.3.2_Documentation.html">EJBCA - Documentation Space</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="EJBCA_Documentation.html">EJBCA Documentation</a></li>
                                                                                                         <li class="shortcut"><a href="EJBCA_Installation.html">EJBCA Installation</a></li>
                                                                                     <li><a href="Application_Servers.html">Application Servers</a></li>
                                                            </ul>
</div>            <h1 id="src-85197107"> <span>WildFly 14 / JBoss EAP 7.2</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">

<p   
>For WildFly, deploy and install does not automatically configure the application server for you. Configure the application server according to instructions in the following sections.</p>
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGREYXRhYmFzZURyaXZlcg">Add Database Driver</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1JbmNyZWFzZUFsbG93ZWRNZW1vcnlVc2FnZQ">Increase Allowed Memory Usage</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGREYXRhU291cmNl">Add DataSource</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Db25maWd1cmVXaWxkRmx5UmVtb3Rpbmc">Configure WildFly Remoting</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Db25maWd1cmVMb2dnaW5n">Configure Logging</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1IVFRQKFMpTGlzdGVuZXJDb25maWd1cmF0aW9ud2l0aDMtcG9ydFNlcGFyYXRpb24">HTTP(S) Listener Configuration with 3-port Separation</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1IVFRQUHJvdG9jb2xCZWhhdmlvckNvbmZpZ3VyYXRpb24">HTTP Protocol Behavior Configuration</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1SZW1vdmVSRVNURWFzeS1DcnlwdG8">Remove RESTEasy-Crypto</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1PcHRpb25hbENvbmZpZ3VyYXRpb24">Optional Configuration</a></p>
</li><li class=" "><p   
><a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1OZXh0U3RlcDpEZXBsb3lpbmdFSkJDQQ">Next Step: Deploying EJBCA</a></p>
</li></ul>    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>For the oracle-specific parts in this guide we assume you have installed Oracle XE version 11g release 2 (can be downloaded from <a  class="external-link" href="https://www.oracle.com/technetwork/database/enterprise-edition/downloads/index.html">Oracle Database</a>) on your machine and configured it to listen on port 1521</p>
        </div>
    </div>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>It is highly inadvisable to run your application using a root user due to risk of privilege escalation. Running your installation as root may lead root privileges being set on files which later WildFly is unable to read. It is instead recommended to run the installation with the same user as is running your application server.</p>
        </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGREYXRhYmFzZURyaXZlcg">
        <h1 class="heading "><span>Add Database Driver</span></h1>
<p   
>For MariaDB and PostgreSQL, the database driver can be added by hot-deploying it into the deployment directory. This will be picked up by WildFly and deployed so we can create a DataSource straight away. You can use a generic name, without version number, in order to get a generic 'driver-name' for the data source command.</p>
<p   
>Example command for MariaDB:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ </code><code class="functions">cp</code><code class="plain"> mariadb-java-client-2.2.6.jar wildfly_home</code><code class="plain">/standalone/deployments/mariadb-java-client</code><code class="plain">.jar</code></div>
</div>
    </div>
<p   
>Example command for PostgreSQL:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ cp postgresql-</code><code class="value">42.2</code><code class="plain">.</code><code class="value">5</code><code class="plain">.jar wildfly_home/standalone/deployments/postgresql.jar</code></div>
</div>
    </div>
<p   
>If you are using another type of database, copy the JDBC driver to the deployment directory and make note of the driver class and driver-name shown in the server log for later use when adding the DataSource. For example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">... INFO  [org.jboss.as.connector.deployers.jdbc] (...) WFLYJCA0005: Deploying non-JDBC-compliant driver class org.postgresql.Driver (version 42.2.5)</code></div>
<div class="line"><code class="plain">... INFO  [org.jboss.as.connector.deployers.jdbc] (...) WFLYJCA0018: Started Driver service with driver-name = postgresql-jdbc3.jar</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1JbmNyZWFzZUFsbG93ZWRNZW1vcnlVc2FnZQ">
        <h1 class="heading "><span>Increase Allowed Memory Usage</span></h1>
<p   
>By default, 1303MB of heap (RAM) is allowed to be used by the application server. This is sufficient for a small/normal installation. If you expect much traffic you can increase this memory limit by editing wildfly_home/bin/standalone.conf to increase this to a higher value, for example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">  JAVA_OPTS=</code><code class="string">"-Xms2048m -Xmx2048m -XX:MetaspaceSize=192M -XX:MaxMetaspaceSize=256m -Djava.net.preferIPv4Stack=true"</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGREYXRhU291cmNl">
        <h1 class="heading "><span>Add DataSource</span></h1>
<p   
>To add a data source for EJBCA to use, start JBoss (with <tt class=" ">bin/standalone.sh</tt>) and run the commands in JBoss CLI according to the <a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1NYXJpYURC">MariaDB</a>, <a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1NeVNRTA">MySQL</a>, <a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1PcmFjbGVYRQ">Oracle XE</a>, or <a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Qb3N0Z3JlU1FM">PostgreSQL</a> examples below.</p>
<p   
>Note that <tt class=" ">-driver-name</tt> is linked to the name of the jar file you copied in the step <a   href="#src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGREYXRhYmFzZURyaXZlcg">Add Database Driver</a> above. The <tt class=" ">-jindi-name</tt> is linked to the database.properties value, and the default value is used in the following example.</p>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1NYXJpYURCTWFyaWFEQg">
        <h2 class="heading "><span id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1NYXJpYURC" class="confluence-anchor-link"></span><span>MariaDB </span></h2>
<p   
>For MariaDB, run the following:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&gt; wildfly_home/bin/jboss-cli.sh -c</code></div>
<div class="line"><code class="plain">&gt; data-source add --name=ejbcads --driver-name="mariadb-java-client.jar" --connection-url="jdbc:</code><code class="comments">mysql://127.0.0.1:3306/ejbca</code><code class="plain">" --jndi-name="java:/EjbcaDS" --use-ccm=true --driver-class="org.mariadb.jdbc.Driver" --user-name="ejbca" --password="ejbca" --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql="select 1;"</code></div>
<div class="line"><code class="plain">&gt; :reload</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1NeVNRTE15U1FM">
        <h2 class="heading "><span id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1NeVNRTA" class="confluence-anchor-link"></span><span>MySQL</span></h2>
<p   
>For MySQL, run the following.</p>
<p   
>Note that MySQL imposes increased secure password creations and the following example uses <tt class=" ">--password=&quot;Ejbca-2020&quot;</tt>.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&gt; data-</code><code class="functions">source</code><code class="plain"> add --name=ejbcads --driver-name=</code><code class="string">"com.mysql.jdbc.Driver"</code><code class="plain"> --connection-url=</code><code class="string">"jdbc:mysql://127.0.0.1:3306/ejbca"</code><code class="plain"> --jndi-name=</code><code class="string">"java:/EjbcaDS"</code><code class="plain"> --use-ccm=</code><code class="functions">true</code><code class="plain"> --driver-class=</code><code class="string">"com.mysql.jdbc.Driver"</code><code class="plain"> --user-name=</code><code class="string">"ejbca"</code><code class="plain"> --password=</code><code class="string">"Ejbca-2020"</code><code class="plain"> --validate-on-match=</code><code class="functions">true</code><code class="plain"> --background-validation=</code><code class="functions">false</code><code class="plain"> --prepared-statements-cache-size=50 --share-prepared-statements=</code><code class="functions">true</code><code class="plain"> --min-pool-size=5 --max-pool-size=150 --pool-prefill=</code><code class="functions">true</code><code class="plain"> --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=</code><code class="string">"select 1;"</code></div>
<div class="line"><code class="plain">&gt; :reload</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1PcmFjbGVYRXZlcnNpb24xMWdSZWxlYXNlMk9yYWNsZVhF">
        <h2 class="heading "><span>Oracle XE version 11g Release 2 </span></h2>
<p   
>    <span style="color: #222222;">
For Oracle XE, run the following:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&gt; wildfly_home</code><code class="plain">/bin/jboss-cli</code><code class="plain">.sh -c</code></div>
<div class="line"><code class="plain">&gt; data-</code><code class="functions">source</code><code class="plain"> add --name=ejbcads --driver-name=</code><code class="string">"ojdbc8.jar"</code><code class="plain"> --connection-url=</code><code class="string">"jdbc:oracle:thin:@127.0.0.1:1521:XE"</code><code class="plain"> --jndi-name=</code><code class="string">"java:/EjbcaDS"</code><code class="plain"> --use-ccm=</code><code class="functions">true</code><code class="plain"> --driver-class=</code><code class="string">"oracle.jdbc.driver.OracleDriver"</code><code class="plain"> --user-name=</code><code class="string">"ejbca"</code><code class="plain"> --password=</code><code class="string">"ejbca"</code><code class="plain"> --validate-on-match=</code><code class="functions">true</code><code class="plain"> --background-validation=</code><code class="functions">false</code><code class="plain"> --prepared-statements-cache-size=50 --share-prepared-statements=</code><code class="functions">true</code><code class="plain"> --min-pool-size=5 --max-pool-size=150 --pool-prefill=</code><code class="functions">true</code><code class="plain"> --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=</code><code class="string">"select 1 from dual"</code></div>
<div class="line"><code class="plain">&gt; :reload</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Qb3N0Z3JlU1FMUG9zdGdyZVNRTA">
        <h2 class="heading subsubsection"><span id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Qb3N0Z3JlU1FM" class="confluence-anchor-link"></span><span>PostgreSQL </span></h2>
<p   
>    <span style="color: #222222;">
For PostgreSQL, run the following:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&gt; wildfly_home</code><code class="plain">/bin/jboss-cli</code><code class="plain">.sh -c</code></div>
<div class="line"><code class="plain">&gt; data-</code><code class="functions">source</code><code class="plain"> add --name=ejbcads --driver-name=</code><code class="string">"org.postgresql.Driver"</code><code class="plain"> --connection-url=</code><code class="string">"jdbc:postgresql://127.0.0.1/ejbca"</code><code class="plain"> --jndi-name=</code><code class="string">"java:/EjbcaDS"</code><code class="plain"> --use-ccm=</code><code class="functions">true</code><code class="plain"> --driver-name=</code><code class="string">"postgresql.jar"</code><code class="plain"> --driver-class=</code><code class="string">"org.postgresql.Driver"</code><code class="plain"> --user-name=</code><code class="string">"ejbca_user"</code><code class="plain"> --password=</code><code class="string">"foo123"</code><code class="plain"> --validate-on-match=</code><code class="functions">true</code><code class="plain"> --background-validation=</code><code class="functions">false</code><code class="plain"> --prepared-statements-cache-size=50 --share-prepared-statements=</code><code class="functions">true</code><code class="plain"> --min-pool-size=5 --max-pool-size=150 --pool-prefill=</code><code class="functions">true</code><code class="plain"> --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql=</code><code class="string">"select 1;"</code></div>
<div class="line"><code class="plain">&gt; :reload</code></div>
</div>
    </div>
<p   
>If you are using another type of database, adapt the statement above with the correct <tt class=" ">driver-name</tt>, <tt class=" ">connection-url,</tt> <tt class=" ">driver-class</tt> and <tt class=" ">check-valid-connection-sql</tt>.</p>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Db25maWd1cmVXaWxkRmx5UmVtb3Rpbmc">
        <h1 class="heading "><span>Configure WildFly Remoting</span></h1>
<p   
>EJBCA needs to use JBoss Remoting for the EJBCA CLI to work. Configure it to use a separate port 4447 and remove any other dependency on remoting except for what EJBCA needs.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=remoting</code><code class="plain">/http-connector</code><code class="plain">=http-remoting-connector:write-attribute(name=connector-ref,value=remoting)</code></div>
<div class="line"><code class="plain">/socket-binding-group</code><code class="plain">=standard-sockets</code><code class="plain">/socket-binding</code><code class="plain">=remoting:add(port=4447,interface=management)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/http-listener</code><code class="plain">=remoting:add(socket-binding=remoting,</code><code class="functions">enable</code><code class="plain">-http2=</code><code class="functions">true</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=infinispan</code><code class="plain">/cache-container</code><code class="plain">=ejb:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=infinispan</code><code class="plain">/cache-container</code><code class="plain">=server:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=infinispan</code><code class="plain">/cache-container</code><code class="plain">=web:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=ejb3</code><code class="plain">/cache</code><code class="plain">=distributable:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=ejb3</code><code class="plain">/passivation-store</code><code class="plain">=infinispan:remove()</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Db25maWd1cmVMb2dnaW5n">
        <h1 class="heading "><span>Configure Logging</span></h1>
<p   
>Configure logging in JBoss to be able to dynamically change logging. For production systems, INFO log level is recommended:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=logging</code><code class="plain">/logger</code><code class="plain">=org.ejbca:add(level=INFO)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=logging</code><code class="plain">/logger</code><code class="plain">=org.cesecore:add(level=INFO)</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>To later enable DEBUG log level, if needed, use the following:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=logging</code><code class="plain">/logger</code><code class="plain">=org.ejbca:write-attribute(name=level, value=DEBUG)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=logging</code><code class="plain">/logger</code><code class="plain">=org.cesecore:write-attribute(name=level, value=DEBUG)</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1IVFRQKFMpTGlzdGVuZXJDb25maWd1cmF0aW9ud2l0aDMtcG9ydFNlcGFyYXRpb24">
        <h1 class="heading "><span>HTTP(S) Listener Configuration with 3-port Separation</span></h1>
<p   
>The following covers HTTP(S) listener configuration with 3-port separation.</p>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1SZW1vdmVFeGlzdGluZ1RMU2FuZEhUVFBDb25maWd1cmF0aW9u">
        <h2 class="heading "><span>Remove Existing TLS and HTTP Configuration</span></h2>
<p   
>Run the following commands in JBoss CLI to remove existing TLS and HTTP configuration (just to be safe):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ wildfly_home</code><code class="plain">/bin/jboss-cli</code><code class="plain">.sh --connect</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/http-listener</code><code class="plain">=default:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/https-listener</code><code class="plain">=https:remove()</code></div>
<div class="line"><code class="plain">/socket-binding-group</code><code class="plain">=standard-sockets</code><code class="plain">/socket-binding</code><code class="plain">=http:remove()</code></div>
<div class="line"><code class="plain">/socket-binding-group</code><code class="plain">=standard-sockets</code><code class="plain">/socket-binding</code><code class="plain">=https:remove()</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p   
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGROZXdJbnRlcmZhY2VzYW5kU29ja2V0cw">
        <h2 class="heading "><span>Add New Interfaces and Sockets</span></h2>
<p   
>To add new interfaces and sockets, use the following:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/interface</code><code class="plain">=http:add(inet-address=</code><code class="string">"0.0.0.0"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/interface</code><code class="plain">=httpspub:add(inet-address=</code><code class="string">"0.0.0.0"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/interface</code><code class="plain">=httpspriv:add(inet-address=</code><code class="string">"0.0.0.0"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/socket-binding-group</code><code class="plain">=standard-sockets</code><code class="plain">/socket-binding</code><code class="plain">=http:add(port=</code><code class="string">"8080"</code><code class="plain">,interface=</code><code class="string">"http"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/socket-binding-group</code><code class="plain">=standard-sockets</code><code class="plain">/socket-binding</code><code class="plain">=httpspub:add(port=</code><code class="string">"8442"</code><code class="plain">,interface=</code><code class="string">"httpspub"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/socket-binding-group</code><code class="plain">=standard-sockets</code><code class="plain">/socket-binding</code><code class="plain">=httpspriv:add(port=</code><code class="string">"8443"</code><code class="plain">,interface=</code><code class="string">"httpspriv"</code><code class="plain">)</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Db25maWd1cmVUTFM">
        <h2 class="heading "><span>Configure TLS</span></h2>
<p   
>Configure TLS according to the following instructions.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Make sure the passwords in this section are correct, in order for the commands not to fail. In production the passwords should be changed to &quot;real&quot; passwords.</p>
        </div>
    </div>
<p   
>Update the keystore-password for keystore.jks to match httpsserver.password and the keystore-password for truststore.jks to match java.truststore in web.properties:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=elytron</code><code class="plain">/key-store</code><code class="plain">=httpsKS:add(path=</code><code class="string">"keystore/keystore.jks"</code><code class="plain">,relative-to=jboss.server.config.</code><code class="functions">dir</code><code class="plain">,credential-reference={</code><code class="functions">clear</code><code class="plain">-text=</code><code class="string">"serverpwd"</code><code class="plain">},</code><code class="functions">type</code><code class="plain">=JKS)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=elytron</code><code class="plain">/key-store</code><code class="plain">=httpsTS:add(path=</code><code class="string">"keystore/truststore.jks"</code><code class="plain">,relative-to=jboss.server.config.</code><code class="functions">dir</code><code class="plain">,credential-reference={</code><code class="functions">clear</code><code class="plain">-text=</code><code class="string">"changeit"</code><code class="plain">},</code><code class="functions">type</code><code class="plain">=JKS)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=elytron</code><code class="plain">/key-manager</code><code class="plain">=httpsKM:add(key-store=httpsKS,algorithm=</code><code class="string">"SunX509"</code><code class="plain">,credential-reference={</code><code class="functions">clear</code><code class="plain">-text=</code><code class="string">"serverpwd"</code><code class="plain">})</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=elytron</code><code class="plain">/trust-manager</code><code class="plain">=httpsTM:add(key-store=httpsTS)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=elytron</code><code class="plain">/server-ssl-context</code><code class="plain">=httpspub:add(key-manager=httpsKM,protocols=[</code><code class="string">"TLSv1.2"</code><code class="plain">])</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=elytron</code><code class="plain">/server-ssl-context</code><code class="plain">=httpspriv:add(key-manager=httpsKM,protocols=[</code><code class="string">"TLSv1.2"</code><code class="plain">],trust-manager=httpsTM,need-client-auth=</code><code class="functions">true</code><code class="plain">,authentication-optional=</code><code class="functions">false</code><code class="plain">,want-client-auth=</code><code class="functions">true</code><code class="plain">)</code></div>
</div>
    </div>
<p  class="label" 
>Optionally, the &quot;httpspriv&quot; context can be configured with optional client certificate authentication using &quot;need-client-auth=false,authentication-optional=true&quot; instead.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGRIVFRQKFMpTGlzdGVuZXJz">
        <h2 class="heading label"><span>Add HTTP(S) Listeners</span></h2>
<p  class="label" 
>To add HTTP(S) listeners:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/http-listener</code><code class="plain">=http:add(socket-binding=</code><code class="string">"http"</code><code class="plain">, redirect-socket=</code><code class="string">"httpspriv"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/https-listener</code><code class="plain">=httpspub:add(socket-binding=</code><code class="string">"httpspub"</code><code class="plain">, ssl-context=</code><code class="string">"httpspub"</code><code class="plain">, max-parameters=2048)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/https-listener</code><code class="plain">=httpspriv:add(socket-binding=</code><code class="string">"httpspriv"</code><code class="plain">, ssl-context=</code><code class="string">"httpspriv"</code><code class="plain">, max-parameters=2048)</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1IVFRQUHJvdG9jb2xCZWhhdmlvckNvbmZpZ3VyYXRpb24">
        <h1 class="heading label"><span>HTTP Protocol Behavior Configuration</span></h1>
<p   
>The following shows an example HTTP Protocol Behavior Configuration.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/system-property</code><code class="plain">=org.apache.catalina.connector.URI_ENCODING:add(value=</code><code class="string">"UTF-8"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/system-property</code><code class="plain">=org.apache.catalina.connector.USE_BODY_ENCODING_FOR_QUERY_STRING:add(value=</code><code class="functions">true</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/system-property</code><code class="plain">=org.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH:add(value=</code><code class="functions">true</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/system-property</code><code class="plain">=org.apache.tomcat.util.http.Parameters.MAX_COUNT:add(value=2048)</code></div>
<div class="line"><code class="plain">/system-property</code><code class="plain">=org.apache.catalina.connector.CoyoteAdapter.ALLOW_BACKSLASH:add(value=</code><code class="functions">true</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=webservices:write-attribute(name=wsdl-host, value=jbossws.undefined.host)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=webservices:write-attribute(name=modify-wsdl-address, value=</code><code class="functions">true</code><code class="plain">)</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p   
>If you are using OCSP GET requests, setting URI encoding and allowing encoding for Query and backslash above are needed.</p>
<p   
>This will also ensure that the address in the EJBCA WS WSDL will match the hostname and port that the client used to access the server.</p>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1SZW1vdmVSRVNURWFzeS1DcnlwdG8">
        <h1 class="heading label"><span>Remove RESTEasy-Crypto</span></h1>
<p   
>The application server can sometimes load its own version of Bouncy Castle, resulting in incompatibility and/or conflict issues.</p>
<p   
>A typical error occurring as a consequence of the wrong Bouncy Castle being loaded in EJBCA is:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">ClassCastException setting BagAttributes, can not set friendly name: : java.lang.ClassCastException: org.bouncycastle.jcajce.provider.asymmetric.x509.X509CertificateObject cannot be cast to org.bouncycastle.jce.interfaces.PKCS12BagAttributeCarrier</code></div>
</div>
    </div>
<p   
>To avoid issues and prevent Wildfly/JBoss from loading the Bouncy Castle library included in the RESTEasy-Crypto module rather than the library included in EJBCA, run the following:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">$ </code><code class="functions">cd</code><code class="plain"> </code><code class="plain">/opt/wildfly</code></div>
<div class="line"><code class="plain">$ </code><code class="functions">sed</code><code class="plain"> -i </code><code class="string">'s|.*org.jboss.resteasy.resteasy-crypto.*||'</code><code class="plain"> modules</code><code class="plain">/system/layers/base/org/jboss/as/jaxrs/main/module</code><code class="plain">.xml</code></div>
<div class="line"><code class="plain">$ </code><code class="functions">rm</code><code class="plain"> -rf modules</code><code class="plain">/system/layers/base/org/jboss/resteasy/resteasy-crypto</code></div>
</div>
    </div>
<p   
>The following displays an example error log message in case of a conflict:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">ERROR [StartupSingletonBean] BouncyCastle is not loaded by an EJBCA classloader, version conflict is likely: </code></div>
<div class="line"><code class="plain">org.bouncycastle.jcajce.provider.asymmetric.x509.X509CertificateObject: #012org.bouncycastle.jcajce.provider.asymmetric.x509.X509CertificateObject(4690542e).</code></div>
<div class="line"><code class="plain">ClassLoader=ModuleClassLoader for Module "org.bouncycastle" from local module loader @3fb6a447 </code></div>
<div class="line"><code class="plain">(finder: local module finder @79b4d0f (roots: /opt/jboss/modules,/opt/jboss/modules/system/layers/base))#012++++CodeSource: </code></div>
<div class="line"><code class="plain">([jar:file:/opt/jboss/modules/system/layers/base/org/bouncycastle/main/bcprov-jdk15on-1.60.jar!/] [#012[#012 Version: V3#012 Subject: </code></div>
<div class="line"><code class="plain">CN=Legion of the Bouncy Castle Inc., OU=Java Software Code Signing, O=Sun Microsystems Inc#012 Signature Algorithm: </code></div>
<div class="line"><code class="plain">SHA1withDSA, OID = 1.2.840.10040.4.3#012#012 Key: Sun DSA Public Key#012 Parameters:DSA#012#011p: </code></div>
<div class="line"><code class="plain">fd7f5381 1d751229 52df4a9c 2eece4e7 f611b752 3cef4400 c31e3f80 b6512669#012 455d4022 51fb593d </code></div>
<div class="line"><code class="plain">8d58fabf c5f5ba30 f6cb9b55 6cd7813b 801d346f f26660b7#012</code></div>
</div>
    </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1PcHRpb25hbENvbmZpZ3VyYXRpb24">
        <h1 class="heading label"><span>Optional Configuration</span></h1>
<p   
>The following sections cover optional configurations.</p>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1SZW1vdmVXZWxjb21lQ29udGVudA">
        <h2 class="heading label"><span>Remove Welcome Content</span></h2>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/host</code><code class="plain">=default-host</code><code class="plain">/location</code><code class="plain">=</code><code class="string">"\/"</code><code class="plain">:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/configuration</code><code class="plain">=handler</code><code class="plain">/file</code><code class="plain">=welcome-content:remove()</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1SZWRpcmVjdHRvQXBwbGljYXRpb25mb3JVbmtub3duVVJMcw">
        <h2 class="heading label"><span>Redirect to Application for Unknown URLs</span></h2>
<p   
>Known URLs starts with <tt class=" ">/ejbca/, /crls, /certificates</tt> or <tt class=" ">/.well-known/</tt> (EST) for EJBCA according to the following example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/configuration</code><code class="plain">=filter</code><code class="plain">/rewrite</code><code class="plain">=redirect-to-app:add(redirect=</code><code class="functions">true</code><code class="plain">,target=</code><code class="string">"/ejbca/"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/host</code><code class="plain">=default-host</code><code class="plain">/filter-ref</code><code class="plain">=redirect-to-app:add(predicate=</code><code class="string">"method(GET) and not path-prefix('/ejbca/','/crls','/certificates','/.well-known/') and not equals({%{LOCAL_PORT}, 4447})"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1VUkxSZXdyaXRpbmdmb3J0aGVDUkxTZXJ2bGV0">
        <h2 class="heading label"><span>URL Rewriting for the CRL Servlet</span></h2>
<p   
>Since EJBCA 7.2, the ability to customize the URL for the CRL store servlet has been removed. For more information, see <a  class="external-link" href="https://jira.primekey.se/browse/ECA-7059">ECA-7059</a> and the <a   href="EJBCA_7.2_Upgrade_Notes.html">EJBCA 7.2 Upgrade Notes</a>.</p>
<p   
>However, you can download CRLs on a different URL by adding a <a  class="external-link" href="https://wildscribe.github.io/JBoss%20EAP/7.2/subsystem/undertow/configuration/filter/rewrite/index.html">rewrite rule in Undertow</a>. As an example, to allow a client to download CRLs from the URL <tt class=" ">/ejbca/crls/</tt> instead of<tt class=" "> /ejbca/publicweb/crls/</tt>, add the following configuration:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/configuration</code><code class="plain">=filter</code><code class="plain">/rewrite</code><code class="plain">=crl-rewrite:add(target=</code><code class="string">"/ejbca/publicweb/crls/$${1}"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/host</code><code class="plain">=default-host</code><code class="plain">/filter-ref</code><code class="plain">=crl-rewrite:add(predicate=</code><code class="string">"method(GET) and regex('/crls/(.*)')"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1SZW1vdmV0aGVFeGFtcGxlRFNEYXRhU291cmNl">
        <h2 class="heading label"><span>Remove the ExampleDS DataSource</span></h2>
<p   
>To optionally remove the ExampleDS DataSource:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem=ee/service=</code><code class="keyword">default</code><code class="plain">-bindings:remove()</code></div>
<div class="line"><code class="plain">data-source remove --name=ExampleDS</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1SZW1vdmVVbm5lZWRlZFN1YnN5c3RlbXNhbmRFeHRlbnNpb25z">
        <h2 class="heading label"><span>Remove Unneeded Subsystems and Extensions</span></h2>
<p   
>To optionally remove the unneeded subsystems and extensions:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=jdr:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=sar:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=jmx:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=pojo:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=ee-security:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=microprofile-config-smallrye:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=microprofile-health-smallrye:remove()</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=microprofile-opentracing-smallrye:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.jboss.as.jdr:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.jboss.as.jmx:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.jboss.as.sar:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.jboss.as.pojo:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.wildfly.extension.ee-security:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.wildfly.extension.microprofile.config-smallrye:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.wildfly.extension.microprofile.health-smallrye:remove()</code></div>
<div class="line"><code class="plain">/extension</code><code class="plain">=org.wildfly.extension.microprofile.opentracing-smallrye:remove()</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
<p  class="subsubsection" 
><img  class="emoticon emoticon-warning"  src="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg" alt="images/s/-98b7og/8401/7d0034e810b0e95b8c0694abfaf748cf5135c15a/_/images/icons/emoticons/warning.svg"   />
 Wait for the reload to complete by checking the server log or the result of <strong class=" "><tt class=" ">:read-attribute(name=server-state)</tt></strong> before continuing.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1FbmFibGVBSlBDb25uZWN0b3I">
        <h2 class="heading label"><span>Enable AJP Connector</span></h2>
<p  class="label" 
>Enabling the AJP connector is only needed if you run an Apache front-end in front of WildFly:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=undertow</code><code class="plain">/server</code><code class="plain">=default-server</code><code class="plain">/ajp-listener</code><code class="plain">=ajp-listener:add(socket-binding=ajp, scheme=https, enabled=</code><code class="functions">true</code><code class="plain">)</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGRTdXBwb3J0Zm9yUEtDUyMxMShIU01zKQ">
        <h2 class="heading "><span>Add Support for PKCS#11 (HSMs)</span></h2>
<p   
>WildFly by default isolates away most sun classes. EJBCA configures JBoss/WildFly to expose these classes (sun/security/pkcs11/wrapper), as of EJBCA 6.6.3, by using a <tt class=" ">jboss-deployment-structure.xml</tt>. This makes configuration in <tt class=" ">modules/system/layers/base/sun/jdk/main/module.xml</tt> not needed.</p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1BZGRTdXBwb3J0Zm9yU2VuZGluZ0VtYWls">
        <h2 class="heading "><span>Add Support for Sending Email</span></h2>
<p   
>To add support for sending email (smtp), configure EjbcaMail with:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/socket-binding-group</code><code class="plain">=standard-sockets</code><code class="plain">/remote-destination-outbound-socket-binding</code><code class="plain">=ejbca-mail-smtp:add(port=</code><code class="string">"993"</code><code class="plain">, host=</code><code class="string">"my.mail.server"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=mail</code><code class="plain">/mail-session</code><code class="plain">=</code><code class="string">"java:/EjbcaMail"</code><code class="plain">:add(jndi-name=java:</code><code class="plain">/EjbcaMail</code><code class="plain">, from=noreply@mymail)</code></div>
<div class="line"><code class="plain">/subsystem</code><code class="plain">=mail</code><code class="plain">/mail-session</code><code class="plain">=</code><code class="string">"java:/EjbcaMail"</code><code class="plain">/server</code><code class="plain">=smtp:add(outbound-socket-binding-ref=ejbca-mail-smtp, tls=</code><code class="functions">true</code><code class="plain">, username=smtpuser, password=smtppassword)</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1Pbmx5SG90RGVwbG95YXRTdGFydHVw">
        <h2 class="heading "><span>Only Hot Deploy at Startup</span></h2>
<p   
>Historically application servers are really bad at cleaning up memory from previous deployments and hot (re-)deploy is discouraged in production. To avoid manual deployment with the management interface, we can specify that the deployment directory should be scanned once at application server startup by setting the scan-interval to 0.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/subsystem</code><code class="plain">=deployment-scanner</code><code class="plain">/scanner</code><code class="plain">=default:write-attribute(name=scan-interval,value=0)</code></div>
</div>
    </div>
<p   
></p>
    </div>
    <div class="section section-2" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1EaXNhYmxlTWFuYWdlbWVudFdlYkNvbnNvbGU">
        <h2 class="heading subsubsection"><span>Disable Management Web Console</span></h2>
<p   
>If you only plan on using the JBoss CLI anyway there is little reason to keep this around.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">/core-service</code><code class="plain">=management</code><code class="plain">/management-interface</code><code class="plain">=http-interface:write-attribute(name=console-enabled,value=</code><code class="functions">false</code><code class="plain">)</code></div>
<div class="line"><code class="plain">:reload</code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-1" id="src-85197107_safe-id-aWQtLldpbGRGbHkxNC9KQm9zc0VBUDcuMnY3LjQuMC1OZXh0U3RlcDpEZXBsb3lpbmdFSkJDQQ">
        <h1 class="heading "><span>Next Step: Deploying EJBCA</span></h1>
<p   
>For instructions on how to build and deploy EJBCA, see <a   href="Deploying_EJBCA.html">Deploying EJBCA.</a></p>
    </div>
        </div>

    </article>


            <nav id="ht-post-nav">
                <a href="WildFly_12___JBoss_EAP_7.1.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>WildFly 12 / JBoss EAP 7.1</span>
        </a>
                <a href="WildFly_18___JBoss_EAP_7.3.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewBox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2"
                          sketch:type="MSShapeGroup"
                          transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>WildFly 18 / JBoss EAP 7.3</span>
        </a>
    </nav>    
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
